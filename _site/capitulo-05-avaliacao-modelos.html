<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>capitulo-05-avaliacao-modelos – tiagolafonso.github.io</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ddd961a2510921635943dfbbd19534c4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">tiagolafonso.github.io</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-avaliacao-modelos" id="toc-sec-avaliacao-modelos" class="nav-link active" data-scroll-target="#sec-avaliacao-modelos">Avaliação dos Modelos de Regressão</a>
  <ul class="collapse">
  <li><a href="#sec-multicolinearidade" id="toc-sec-multicolinearidade" class="nav-link" data-scroll-target="#sec-multicolinearidade">Diagnóstico da Multicolinearidade</a>
  <ul class="collapse">
  <li><a href="#análise-gráfica" id="toc-análise-gráfica" class="nav-link" data-scroll-target="#análise-gráfica">Análise gráfica</a></li>
  <li><a href="#matriz-das-correlações" id="toc-matriz-das-correlações" class="nav-link" data-scroll-target="#matriz-das-correlações">Matriz das correlações</a></li>
  <li><a href="#regressão" id="toc-regressão" class="nav-link" data-scroll-target="#regressão">Regressão</a></li>
  <li><a href="#regressão-entre-variáveis-independentes" id="toc-regressão-entre-variáveis-independentes" class="nav-link" data-scroll-target="#regressão-entre-variáveis-independentes">Regressão entre variáveis independentes</a></li>
  <li><a href="#teste-vif" id="toc-teste-vif" class="nav-link" data-scroll-target="#teste-vif">Teste VIF</a></li>
  </ul></li>
  <li><a href="#sec-heterocedasticidade" id="toc-sec-heterocedasticidade" class="nav-link" data-scroll-target="#sec-heterocedasticidade">Diagnóstico da Heterocedasticidade</a>
  <ul class="collapse">
  <li><a href="#graficamente" id="toc-graficamente" class="nav-link" data-scroll-target="#graficamente">Graficamente</a></li>
  <li><a href="#testes-formais" id="toc-testes-formais" class="nav-link" data-scroll-target="#testes-formais">Testes formais</a></li>
  </ul></li>
  <li><a href="#diagnóstico-da-autocorrelação-dos-erros" id="toc-diagnóstico-da-autocorrelação-dos-erros" class="nav-link" data-scroll-target="#diagnóstico-da-autocorrelação-dos-erros">Diagnóstico da Autocorrelação dos erros</a>
  <ul class="collapse">
  <li><a href="#gráfico" id="toc-gráfico" class="nav-link" data-scroll-target="#gráfico">Gráfico</a></li>
  <li><a href="#teste-de-durbin-watson" id="toc-teste-de-durbin-watson" class="nav-link" data-scroll-target="#teste-de-durbin-watson">Teste de Durbin-Watson</a></li>
  <li><a href="#teste-de-breusch-godfrey" id="toc-teste-de-breusch-godfrey" class="nav-link" data-scroll-target="#teste-de-breusch-godfrey">Teste de Breusch-Godfrey</a></li>
  </ul></li>
  <li><a href="#sec-normalidade" id="toc-sec-normalidade" class="nav-link" data-scroll-target="#sec-normalidade">Diagnóstico da Normalidade</a>
  <ul class="collapse">
  <li><a href="#histograma" id="toc-histograma" class="nav-link" data-scroll-target="#histograma">Histograma</a></li>
  <li><a href="#teste-de-shapiro-wilk" id="toc-teste-de-shapiro-wilk" class="nav-link" data-scroll-target="#teste-de-shapiro-wilk">Teste de Shapiro-Wilk</a></li>
  <li><a href="#teste-de-jarque-bera" id="toc-teste-de-jarque-bera" class="nav-link" data-scroll-target="#teste-de-jarque-bera">Teste de Jarque Bera</a></li>
  </ul></li>
  <li><a href="#sec-especificacao" id="toc-sec-especificacao" class="nav-link" data-scroll-target="#sec-especificacao">Testes de Especificação e Estabilidade</a>
  <ul class="collapse">
  <li><a href="#avaliar-a-especificação" id="toc-avaliar-a-especificação" class="nav-link" data-scroll-target="#avaliar-a-especificação">Avaliar a Especificação</a></li>
  <li><a href="#teste-de-ramsey-reset" id="toc-teste-de-ramsey-reset" class="nav-link" data-scroll-target="#teste-de-ramsey-reset">Teste de Ramsey RESET</a></li>
  <li><a href="#teste-de-estabilidade-dos-coeficientes" id="toc-teste-de-estabilidade-dos-coeficientes" class="nav-link" data-scroll-target="#teste-de-estabilidade-dos-coeficientes">Teste de estabilidade dos coeficientes</a></li>
  </ul></li>
  <li><a href="#testes-gerais" id="toc-testes-gerais" class="nav-link" data-scroll-target="#testes-gerais">Testes Gerais</a></li>
  <li><a href="#sec-selecao-modelos" id="toc-sec-selecao-modelos" class="nav-link" data-scroll-target="#sec-selecao-modelos">Seleção de Modelos</a>
  <ul class="collapse">
  <li><a href="#all-in" id="toc-all-in" class="nav-link" data-scroll-target="#all-in"><em>All in</em></a></li>
  <li><a href="#backward-elimination" id="toc-backward-elimination" class="nav-link" data-scroll-target="#backward-elimination"><em>Backward Elimination</em></a></li>
  <li><a href="#forward-selection" id="toc-forward-selection" class="nav-link" data-scroll-target="#forward-selection"><em>Forward Selection</em></a></li>
  <li><a href="#stepwise-selection" id="toc-stepwise-selection" class="nav-link" data-scroll-target="#stepwise-selection"><em>Stepwise Selection</em></a></li>
  <li><a href="#seleção-por-scores" id="toc-seleção-por-scores" class="nav-link" data-scroll-target="#seleção-por-scores">Seleção por Scores</a></li>
  <li><a href="#validação-cruzada" id="toc-validação-cruzada" class="nav-link" data-scroll-target="#validação-cruzada">Validação Cruzada</a></li>
  <li><a href="#validação-cruzada-k-fold" id="toc-validação-cruzada-k-fold" class="nav-link" data-scroll-target="#validação-cruzada-k-fold">Validação Cruzada k-Fold</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="sec-avaliacao-modelos" class="level1">
<h1>Avaliação dos Modelos de Regressão</h1>
<p>Para da significância estatística dos coeficientes e do modelo existem outros testes para assegurar a validade dos resultados. Existem testes de diagnóstico ao erros (heterocedasticidade, autocorrelação, normalidade), ao modelo (especificação), às variáveis (multicolinearidade), à estabilidade (estabilidade dos coeficientes e do modelo). Além disso, existem critérios para comparar modelos alternativos (R², AIC, BIC), métodos de selecção de modelos (stepwise, validação cruzada) e técnicas para identificar observações influentes.</p>
<section id="sec-multicolinearidade" class="level2">
<h2 class="anchored" data-anchor-id="sec-multicolinearidade">Diagnóstico da Multicolinearidade</h2>
<p>Existem várias formas de detectar a multicolinearidade entre as variáveis independentes num modelo de regressão. Vamos utilizar os dados do ficheiro <code>m_reg.xlsx</code>. O ficheiro pode ser descarregado em https://github.com/tiagolafonso/Files_Intro_Applied_Econometrics. Os dados foram recolhidos no <em>World Development Indicators</em> e contêm as seguintes variáveis:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 32%">
<col style="width: 67%">
</colgroup>
<thead>
<tr class="header">
<th>Código</th>
<th>Descrição</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>gdp</td>
<td>PIB (preços constantes, moeda local)</td>
</tr>
<tr class="even">
<td>air</td>
<td>Transporte aéreo, passageiros transportados</td>
</tr>
<tr class="odd">
<td>rail</td>
<td>Transporte ferroviário, passageiros transportados (milhões de passageiros)</td>
</tr>
<tr class="even">
<td>agri</td>
<td>Agricultura, silvicultura e pesca, valor acrescentado (preços constantes, moeda local)</td>
</tr>
<tr class="odd">
<td>ind</td>
<td>Indústria (incluindo construção), valor acrescentado (preços constantes, moeda local)</td>
</tr>
<tr class="even">
<td>man</td>
<td>Indústria transformadora, valor acrescentado (preços constantes, moeda local)</td>
</tr>
<tr class="odd">
<td>ser</td>
<td>Serviços, valor acrescentado (preços constantes, moeda local)</td>
</tr>
<tr class="even">
<td>x</td>
<td>Exportações de bens e serviços (preços constantes, moeda local)</td>
</tr>
<tr class="odd">
<td>m</td>
<td>Importações de bens e serviços (preços constantes, moeda local)</td>
</tr>
<tr class="even">
<td>gfcf</td>
<td>Formação bruta de capital fixo (preços constantes, moeda local)</td>
</tr>
</tbody>
</table>
<p>Importar os dados para o <code>R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#limpar ambiente</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># carregar bibliotecas necessárias</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#importar dados</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>m_reg <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"m_reg.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Neste exemplo, vamos analisar a multicolinearidade para as variáveis independentes para o modelo:</p>
<p><span id="eq-reg-multi"><span class="math display">\[
gdp_t=\beta_0 + \beta_1 ind_t + \beta_2 ser_t + \beta_3 agri_t + \beta_4 man_t + \mu_t
\tag{1}\]</span></span></p>
<section id="análise-gráfica" class="level3">
<h3 class="anchored" data-anchor-id="análise-gráfica">Análise gráfica</h3>
<p>Para a análise gráfico podemos fazer de duas formas: através de um gráfico de dispersão entre duas variáveis, ou através de dois gráficos de linhas comparando as séries temporais das variáveis.</p>
<p>O grafíco de dispersão entre duas variáveis pode ser feito com a função <code>ggplot()</code>. Para este exemplo camos comparar a variável <code>man</code> com a <code>ind</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(m_reg, <span class="fu">aes</span>(<span class="at">x =</span> man, <span class="at">y =</span> ind)) <span class="sc">+</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gráfico de Dispersão: man vs ind"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Indústria Transformadora"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Indústria"</span>) <span class="sc">+</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="co">#tema para o gráfico</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"gray50"</span>),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/grafico_dispersao_man_ind-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Através do gráfico de dispersão, podemos observar a relação entre as variáveis <code>man</code> e <code>ind</code>, o que pode indicar a presença de multicolinearidade imperfeita. Pois parece existe uma relação linear entre as duas variáveis (é possível fazer uma regressão linear bem ajustada para representar as observações). Se não fosse possível fazer uma regressão linear bem ajustada, poderíamos considerar que não há multicolinearidade entre as duas variáveis.</p>
<p>Para o gráfico de linhas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar dados para o gráfico</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dados_graf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">tempo =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(m_reg),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">man =</span> m_reg<span class="sc">$</span>man,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ind =</span> m_reg<span class="sc">$</span>ind</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico combinado</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados_graf, <span class="fu">aes</span>(<span class="at">x =</span> tempo)) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> man, <span class="at">color =</span> <span class="st">"Indústria Transformadora"</span>), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ind, <span class="at">color =</span> <span class="st">"Indústria"</span>), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Indústria Transformadora"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>, </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Indústria"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparação das Séries Temporais: man vs ind"</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="st">"Tempo"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> <span class="st">"Valor"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"Variáveis"</span>) <span class="sc">+</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/graf_linhas-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>O comportamento das séries ao longo do tempo é muito semelhantes, o que pode indicar a presença de multicolinearidade imperfeita.</p>
</section>
<section id="matriz-das-correlações" class="level3">
<h3 class="anchored" data-anchor-id="matriz-das-correlações">Matriz das correlações</h3>
<p>Outra forma de detetar a multicolinearidade é através da matriz de correlação. A matriz de correlação mostra o grau de associação linear entre as variáveis. Cada valor na matriz varia entre -1 e 1, onde valores próximos de 1 ou -1 indicam uma forte correlação, o que pode indicar a presença de multicolinearidade.</p>
<p>Para a matriz de correlação, podemos utilizar a função <code>cor()</code> do <code>R</code>. Vamos calcular a matriz de correlação para as variáveis de interesse do conjunto de dados <code>m_reg</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># selecionar variáveis de interesse</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>mreg_sel <span class="ot">&lt;-</span> m_reg <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(ind, ser, agri, man)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de correlação</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(mreg_sel)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>cor_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           ind       ser      agri       man
ind  1.0000000 0.7093591 0.5217541 0.9155984
ser  0.7093591 1.0000000 0.7109302 0.9103241
agri 0.5217541 0.7109302 1.0000000 0.6737959
man  0.9155984 0.9103241 0.6737959 1.0000000</code></pre>
</div>
</div>
<p>Onde podemos ver que as variáveis <code>ind</code> e <code>man</code> têm uma correlação alta, o que pode indicar a presença de multicolinearidade. Nas restantes a correlação não é assim tão elevada.</p>
<p>Também podemos criar uma matriz gráfica com o package <code>corrplot</code>. Informações detalhadas sobre esta biblioteca podem ser encontradas em <a href="https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html">An Introduction to corrplot Package</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.95 loaded</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#com números</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>cor_1 <span class="ot">&lt;-</span> <span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">"number"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/corrplot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#com círculos</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cor_2 <span class="ot">&lt;-</span> <span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">"circle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/corrplot-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#com números e circulos</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>cor_3 <span class="ot">&lt;-</span> <span class="fu">corrplot.mixed</span>(cor_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/corrplot-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="regressão" class="level3">
<h3 class="anchored" data-anchor-id="regressão">Regressão</h3>
<p>O primeiro passo é estimar o modelo de regressão com as variáveis independentes para <a href="#eq-reg-multi" class="quarto-xref">Equation&nbsp;1</a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>modelo_multi <span class="ot">&lt;-</span> <span class="fu">lm</span>(gdp <span class="sc">~</span> ind <span class="sc">+</span> ser <span class="sc">+</span> agri <span class="sc">+</span> man, <span class="at">data =</span> m_reg)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_multi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = gdp ~ ind + ser + agri + man, data = m_reg)

Residuals:
       Min         1Q     Median         3Q        Max 
-1.222e+10 -3.659e+09  3.956e+08  3.477e+09  1.778e+10 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  7.293e+10  2.724e+10   2.678   0.0137 *  
ind          1.619e+00  1.868e-01   8.665 1.53e-08 ***
ser          1.396e+00  2.647e-02  52.754  &lt; 2e-16 ***
agri        -5.464e-01  8.305e-01  -0.658   0.5174    
man         -3.940e-01  4.227e-01  -0.932   0.3615    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.563e+09 on 22 degrees of freedom
Multiple R-squared:  0.9995,    Adjusted R-squared:  0.9994 
F-statistic: 1.112e+04 on 4 and 22 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>No resultado anterior temos 2 de 4 variáveis que não são estatisticamente diferentes de 0 (agri<code>,</code>man`), contudo o modelo tem um R² ajustado muito elevado (0.99), o que pode indicar a presença de multicolinearidade. Neste caso não conseguimos determinar quais as variáveis que estão a causar este problema.</p>
</section>
<section id="regressão-entre-variáveis-independentes" class="level3">
<h3 class="anchored" data-anchor-id="regressão-entre-variáveis-independentes">Regressão entre variáveis independentes</h3>
<p>Este método consiste em estimar a regressão entre duas das variáveis independentes, ou seja, estimar a regressão do método de deteção de multicolinearidade pelo gráfico de dispersão. Quais as variáveis que devemos escolher neste caso? Com já temos uma anáilise de correlações e gráfica, já sabemos quais as que devemos testar. Caso contrário teríamos que fazer várias regressões com duas das variáveis independentes de cada vez. Para a regressão:</p>
<p><span class="math display">\[
man_t = \beta_0 + \beta_1 ind_t + \epsilon_t
\]</span></p>
<p>No <code>R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>modelo_ind <span class="ot">&lt;-</span> <span class="fu">lm</span>(man <span class="sc">~</span> ind <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> m_reg)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_ind)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = man ~ ind - 1, data = m_reg)

Residuals:
       Min         1Q     Median         3Q        Max 
-1.420e+10 -6.354e+09 -4.233e+09  7.569e+09  1.409e+10 

Coefficients:
    Estimate Std. Error t value Pr(&gt;|t|)    
ind 0.565867   0.004297   131.7   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.529e+09 on 26 degrees of freedom
Multiple R-squared:  0.9985,    Adjusted R-squared:  0.9984 
F-statistic: 1.734e+04 on 1 and 26 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>O R² é muito elevado (0.999), o que indica a presença de multicolinearidade entre as variáveis <code>man</code> e <code>ind</code>. O que indique que a variação de <code>man</code> pode ser explicada em grande parte pela variação de <code>ind</code>.</p>
<p>em que graficamente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(m_reg, <span class="fu">aes</span>(<span class="at">x =</span> ind, <span class="at">y =</span> man)) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">size =</span> <span class="fl">5.5</span>) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> x <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Regressão Linear: Indústria vs Indústria Transformadora"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Indústria (ind)"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Indústria Transformadora (man)"</span>) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="co">#tema para o gráfico</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/grafico_reg_multi_ind-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A conclusão permance, suspeitamos que existe multicolinearidade imperfeita entre estas duas variáveis. També poderíamos inverter a variável dependente pela independente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>modelo_ind_inv <span class="ot">&lt;-</span> <span class="fu">lm</span>(ind <span class="sc">~</span> man <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> m_reg)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_ind_inv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ind ~ man - 1, data = m_reg)

Residuals:
       Min         1Q     Median         3Q        Max 
-2.425e+10 -1.278e+10  8.000e+09  1.181e+10  2.554e+10 

Coefficients:
    Estimate Std. Error t value Pr(&gt;|t|)    
man   1.7646     0.0134   131.7   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.506e+10 on 26 degrees of freedom
Multiple R-squared:  0.9985,    Adjusted R-squared:  0.9984 
F-statistic: 1.734e+04 on 1 and 26 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Em que podemos observar a mesma conclusão.</p>
</section>
<section id="teste-vif" class="level3">
<h3 class="anchored" data-anchor-id="teste-vif">Teste VIF</h3>
<p>Por último o teste VIF que é o mais utilizado em econometria. O teste VIF consiste em calcular para cada uma das variáveis independentes quanto a variância de um coeficiente da regressão é inflacionada devido à presença de multicolinearidade. O VIF é dado por:</p>
<p><span id="eq-vif"><span class="math display">\[
VIF_i = \frac{1}{1 - R^2_i}
\tag{2}\]</span></span></p>
<p>em que <span class="math inline">\(R^2_i\)</span> é o coeficiente de determinação da regressão da variável <span class="math inline">\(X_i\)</span> em função das restantes variáveis independentes. Para a equação <a href="#eq-reg-multi" class="quarto-xref">Equation&nbsp;1</a> (objeto <code>modelo_multi</code>) vamos estimar a regressão de cada variável independente em função das restantes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>modelo_multi_ind <span class="ot">&lt;-</span> <span class="fu">lm</span>(ind <span class="sc">~</span> ser <span class="sc">+</span> agri <span class="sc">+</span> man, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> m_reg)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>modelo_multi_ser <span class="ot">&lt;-</span> <span class="fu">lm</span>(ser <span class="sc">~</span> ind <span class="sc">+</span> agri <span class="sc">+</span> man, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> m_reg)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>modelo_multi_agri <span class="ot">&lt;-</span> <span class="fu">lm</span>(agri <span class="sc">~</span> ind <span class="sc">+</span> ser <span class="sc">+</span> man, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> m_reg)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>modelo_multi_man <span class="ot">&lt;-</span> <span class="fu">lm</span>(man <span class="sc">~</span> ind <span class="sc">+</span> ser <span class="sc">+</span> agri, </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> m_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora vamos extrair o <code>R^2</code> de cada uma das regressões (<code>$r.squared</code>) e calcular o VIF com a <a href="#eq-vif" class="quarto-xref">Equation&nbsp;2</a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrair R²</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>r2_ind <span class="ot">&lt;-</span> <span class="fu">summary</span>(modelo_multi_ind)<span class="sc">$</span>r.squared</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>r2_ser <span class="ot">&lt;-</span> <span class="fu">summary</span>(modelo_multi_ser)<span class="sc">$</span>r.squared</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>r2_agri <span class="ot">&lt;-</span> <span class="fu">summary</span>(modelo_multi_agri)<span class="sc">$</span>r.squared</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>r2_man <span class="ot">&lt;-</span> <span class="fu">summary</span>(modelo_multi_man)<span class="sc">$</span>r.squared</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular VIF</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>vif_ind <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> r2_ind)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>vif_ser <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> r2_ser)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>vif_agri <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> r2_agri)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>vif_man <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> r2_man)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#mostrar o VIF</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>vif_values <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">c</span>(<span class="st">"Indústria"</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Serviços"</span>,</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Agricultura"</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Indústria Transformadora"</span>),</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">VIF =</span> <span class="fu">c</span>(vif_ind, vif_ser, vif_agri, vif_man)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vif_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Variable       VIF
1                Indústria 14.182238
2                 Serviços 13.372233
3              Agricultura  2.074316
4 Indústria Transformadora 41.424816</code></pre>
</div>
</div>
<p>Em alternativa, e esta bem mais prática, podemos usar a função <code>vif()</code> da biblioteca <code>car</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'car'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    recode</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(modelo_multi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ind       ser      agri       man 
14.182238 13.372233  2.074316 41.424816 </code></pre>
</div>
</div>
<p>A biblioteca <code>performance</code> pode ser utilizada para calcular o VIF e outras métricas para uma análise de colinearidade mais informativa. Para isso recorremos à função <code>check_collinearity()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">check_collinearity</span>(modelo_multi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Check for Multicollinearity

Low Correlation

 Term  VIF     VIF 95% CI adj. VIF Tolerance Tolerance 95% CI
 agri 2.07 [ 1.47,  3.43]     1.44      0.48     [0.29, 0.68]

High Correlation

 Term   VIF     VIF 95% CI adj. VIF Tolerance Tolerance 95% CI
  ind 14.18 [ 8.39, 24.50]     3.77      0.07     [0.04, 0.12]
  ser 13.37 [ 7.93, 23.09]     3.66      0.07     [0.04, 0.13]
  man 41.42 [24.00, 72.05]     6.44      0.02     [0.01, 0.04]</code></pre>
</div>
</div>
<p>Esta função (mais info <code>?check_collinearity</code>) fornece uma visão geral da colinearidade entre as variáveis independentes. Separa as variáveis em grupos com base na sua colinearidade (baixa e alta). apresenta também o Intervalo de confiança para o VIF (<code>VIF 95% CI</code>). Apresenta mais duas métricas como a <code>Increased SE</code> que indica o aumento percentual do erro padrão do coeficiente devido à colinearidade, e a <code>Tolerance</code> que é o inverso do VIF (1/VIF). Análise para a variável <code>man</code>:</p>
<ul>
<li><code>Increased SE</code>:6.44 - 6.44 vezes maior que o desvio padrão esperado para o coeficiente</li>
<li><code>Tolerance</code>:0.02 - Indica que apenas 2% da variância é independente</li>
</ul>
<p>Portanto, podemos concluir que existe uma forte multicolinearidade.</p>
</section>
</section>
<section id="sec-heterocedasticidade" class="level2">
<h2 class="anchored" data-anchor-id="sec-heterocedasticidade">Diagnóstico da Heterocedasticidade</h2>
<p>Para esta aplicação vamos utilizar o conjunto de dados <code>hprice1</code> da biblioteca <code>wooldridge</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregar bibliotecas necessárias</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wooldridge)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregar dados</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"hprice1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A heterocedasticidade é medida nos erros. Para isso, vamos utilizar o modelo base (<code>modelo_0</code>) e obter os resíduos <code>u_i</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#estimar modelo</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>modelo_0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> lotsize <span class="sc">+</span> sqrft <span class="sc">+</span> bdrms,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> hprice1)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># armazenar erro no data frame</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>hprice1<span class="sc">$</span>u_i <span class="ot">&lt;-</span> <span class="fu">residuals</span>(modelo_0)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hprice1<span class="sc">$</span>u_i) <span class="co">#eststistica descritiva do erro</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-120.026  -38.530   -6.555    0.000   32.323  209.376 </code></pre>
</div>
</div>
<section id="graficamente" class="level3">
<h3 class="anchored" data-anchor-id="graficamente">Graficamente</h3>
<p>Para testar a heterocedasticidade graficamente, podemos utilizar um gráfico de dispersão dos resíduos em relação aos valores ajustados ou com outra variável independente. Se os resíduos apresentarem um padrão específico (como um funil ou uma curva), pode indicar a presença de heterocedasticidade dos erros.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de dispersão dos resíduos</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hprice1, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fitted</span>(modelo_0), <span class="at">y =</span> u_i)) <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gráfico de Resíduos vs Valores Ajustados"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valores Ajustados"</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Resíduos"</span>) <span class="sc">+</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/grafico-residuos_het-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="testes-formais" class="level3">
<h3 class="anchored" data-anchor-id="testes-formais">Testes formais</h3>
<section id="teste-de-breusch-pagan" class="level4">
<h4 class="anchored" data-anchor-id="teste-de-breusch-pagan">Teste de Breusch-Pagan</h4>
<p>Um dos testes mais utilizado para testar a heterocedasticidade é o teste de Breusch-Pagan <span class="citation" data-cites="breusch_simple_1979">[@breusch_simple_1979]</span>. Os testes têm um processo semelhante como referido na secção de pressupostos de homocedasticidade do capítulo anterior. A regressão auxiliar do teste é dada por:</p>
<p><span class="math display">\[
{\mu_i}^2 = \delta_0 + \delta_1 lotsize_i + \delta_2 sqrft_i + \delta_3 bdrms_i + \sigma_i
\]</span></p>
<p>Depois de estimar vamos obter o <span class="math inline">\(LM_{stat}=n*R^2\)</span> e calcular o valor da probabilidade do <span class="math inline">\(\chi^2\)</span>.</p>
<p>No R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calcular u_i^2</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>hprice1<span class="sc">$</span>u_i2 <span class="ot">&lt;-</span> hprice1<span class="sc">$</span>u_i<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Estimar reg-bp</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>reg_bp <span class="ot">&lt;-</span> <span class="fu">lm</span>(u_i2 <span class="sc">~</span> lotsize <span class="sc">+</span> sqrft <span class="sc">+</span> bdrms, <span class="at">data =</span> hprice1)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Obter R2</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>r2_bp <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg_bp)<span class="sc">$</span>r.squared</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Obter n</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(hprice1)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Número de variáveis independentes - k</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> reg_bp<span class="sc">$</span>rank <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co"># LM stat</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>LM_stat_bp <span class="ot">&lt;-</span> n <span class="sc">*</span> r2_bp</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Obter valor P</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>p_value_bp <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(LM_stat_bp, <span class="at">df =</span> k)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>p_value_bp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.00278206</code></pre>
</div>
</div>
<p>O <code>$r.squared</code> extrai o valor de R² da regressão auxiliar, que é utilizado para calcular o estatístico LM do teste de Breusch-Pagan. O <code>$rank</code> devolve o número de coeficientes (-1 para excluis a constante). A função <code>pchisq()</code> é utilizada para calcular o valor p associado ao estatístico LM, com base na distribuição qui-quadrado, onde <code>df</code> é o número de variáveis independentes na regressão auxiliar (k). Este processo pode ser mais trabalhoso, mas é possível executar qualquer test de heterocedasticidade.</p>
<p>A biblioteca <code>skedastic</code> tem várias funções para testar a heterocedasticidade. Neste caso, o teste de Breusch-Pagan pode ser obtido com a função <code>breusch_pagan()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skedastic)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">breusch_pagan</span>(modelo_0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  statistic p.value parameter method                alternative
      &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                 &lt;chr&gt;      
1      14.1 0.00278         3 Koenker (studentised) greater    </code></pre>
</div>
</div>
<p>A conclusão (o valor de P é o mesmo) é que a hipótese nula é rejeitada para qualquer nível de significância estatística. Em que <strong>a hipótese nula do teste de heterocedasticidade é: os erros são homocedásticos</strong>.</p>
</section>
<section id="teste-de-glesjer" class="level4">
<h4 class="anchored" data-anchor-id="teste-de-glesjer">Teste de Glesjer</h4>
<p>O teste de Glesjer <span class="citation" data-cites="glejser_new_1969">[@glejser_new_1969]</span> tem como a regressão auxiliar:</p>
<p><span id="eq-glesjer"><span class="math display">\[
|\mu_i| = \delta_0 + \delta_1 \cdot lotsize_i + \delta_2 \cdot sqrft_i + \delta_3 \cdot bdrms_i + \sigma_i
\tag{3}\]</span></span></p>
<p>O processo é semelhante ao teste de Breusch-Pagan. No R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular |u_i|</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>hprice1<span class="sc">$</span>u_i_abs <span class="ot">&lt;-</span> <span class="fu">abs</span>(hprice1<span class="sc">$</span>u_i)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar reg-glesjer</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>reg_glesjer <span class="ot">&lt;-</span> <span class="fu">lm</span>(u_i_abs <span class="sc">~</span> lotsize <span class="sc">+</span> sqrft <span class="sc">+</span> bdrms, </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> hprice1)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Obter R2</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>r2_glesjer <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg_glesjer)<span class="sc">$</span>r.squared</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Obter n</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(hprice1)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Número de variáveis independentes - k</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> reg_glesjer<span class="sc">$</span>rank <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co"># LM stat</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>LM_stat_glesjer <span class="ot">&lt;-</span> n <span class="sc">*</span> r2_glesjer</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Obter valor P</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>p_value_glesjer <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(LM_stat_glesjer, </span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>                        <span class="at">df =</span> k)</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>p_value_glesjer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0004458974</code></pre>
</div>
</div>
<p>O mesmo resultado pode ser obtido utilizando a função <code>gl()</code> da biblioteca <code>skedastic</code>. A hipótese nula é rejeitada para qualquer nível de significância estatística.</p>
<section id="teste-de-harvey-godfrey" class="level5">
<h5 class="anchored" data-anchor-id="teste-de-harvey-godfrey">Teste de Harvey-Godfrey</h5>
<p>O teste Harvey-Godfrey <span class="citation" data-cites="harvey_estimating_1976">[@harvey_estimating_1976, @godfrey_testing_1978]</span> tem como regressão auxiliar:</p>
<p><span id="eq-harvey-godfrey"><span class="math display">\[
ln(\mu_i^2) = \delta_0 + \delta_1 lotsize_i + \delta_2 sqrft_i + \delta_3 bdrms_i + \sigma_i
\tag{4}\]</span></span></p>
<p>O processo é semelhante a qualquer LM teste para heterocedasticidade. Tabém pode ser obtido utilizando a função <code>harvey_godfrey()</code> da biblioteca <code>skedastic</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">harvey</span>(modelo_0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  statistic p.value parameter alternative
      &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      
1      8.49  0.0370         3 greater    </code></pre>
</div>
</div>
<p>Neste caso a hipótese nula é rejeitada para 5% e 10% de significância estatística.</p>
</section>
</section>
<section id="teste-de-park" class="level4">
<h4 class="anchored" data-anchor-id="teste-de-park">Teste de Park</h4>
<p>O teste de Park <span class="citation" data-cites="park_estimation_1966">[@park_estimation_1966]</span> tem como regressão auxiliar:</p>
<p><span id="eq-park"><span class="math display">\[
ln(\mu_i^2) = \delta_0 + \delta_1 ln(lotsize_i) + \delta_2 ln(sqrft_i) + \delta_3 ln(bdrms_i) + \sigma_i
\tag{5}\]</span></span></p>
<p>A bibliotca <code>skedastic</code> não tem o teste de Park. Este é um dos exemplos em que temos que fazer o processo passo a passo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular ln(u_i^2)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>hprice1<span class="sc">$</span>ln_u_i2 <span class="ot">&lt;-</span> <span class="fu">log</span>(hprice1<span class="sc">$</span>u_i<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar regressão auxiliar</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>reg_park <span class="ot">&lt;-</span> <span class="fu">lm</span>(ln_u_i2 <span class="sc">~</span> <span class="fu">log</span>(lotsize) <span class="sc">+</span> <span class="fu">log</span>(sqrft) <span class="sc">+</span> <span class="fu">log</span>(bdrms),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> hprice1)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Obter R2</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>r2_park <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg_park)<span class="sc">$</span>r.squared</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Obter n</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(hprice1)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Número de variáveis independentes - k</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> reg_park<span class="sc">$</span>rank <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co"># LM stat</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>LM_stat_park <span class="ot">&lt;-</span> n <span class="sc">*</span> r2_park</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Obter valor P</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>p_value_park <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(LM_stat_park, <span class="at">df =</span> k)</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>p_value_park</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1142573</code></pre>
</div>
</div>
<p>A hipótese nula de homocedasticidade não é rejeitada para nenhum nível de significância estatística.</p>
</section>
<section id="teste-de-white" class="level4">
<h4 class="anchored" data-anchor-id="teste-de-white">Teste de White</h4>
<p>O teste de White <span class="citation" data-cites="white_heteroskedasticity-consistent_1980">[@white_heteroskedasticity-consistent_1980]</span> é um teste geral para heterocedasticidade que não assume uma forma específica de heterocedasticidade. A regressão auxiliar do teste de White inclui as variáveis independentes e os termos quadráticos:</p>
<p><span id="eq-white"><span class="math display">\[
\begin{split}
{\mu_i}^2 = \delta_0 &amp; + \delta_1 lotsize_i + \delta_2 sqrft_i + \delta_3 bdrms_i \\
&amp;+ \delta_4 lotsize_i^2 + \delta_5 sqrft_i^2 + \delta_6 bdrms_i^2 + \sigma_i
\end{split}
\tag{6}\]</span></span></p>
<p>e pode incluir também interações entre as variáveis independentes :</p>
<p><span id="eq-white-cross"><span class="math display">\[
\begin{split}
{\mu_i}^2 = \delta_0 &amp;+ \delta_1 lotsize_i + \delta_2 sqrft_i + \delta_3 bdrms_i \\
&amp;+ \delta_4 lotsize_i^2 + \delta_5 sqrft_i^2 + \delta_6 bdrms_i^2 \\
&amp;+ \delta_7 (lotsize_i \cdot sqrft_i) + \delta_8 (lotsize_i \cdot bdrms_i) \\
&amp;+ \delta_9 (sqrft_i \cdot bdrms_i) + \sigma_i
\end{split}
\tag{7}\]</span></span></p>
<p>Para a <a href="#eq-white" class="quarto-xref">Equation&nbsp;6</a> podemos utilizar a função <code>white()</code> da biblioteca <code>skedastic</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">white</span>(modelo_0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  statistic p.value parameter method       alternative
      &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      
1      20.6 0.00216         6 White's Test greater    </code></pre>
</div>
</div>
<p>e para a <a href="#eq-white-cross" class="quarto-xref">Equation&nbsp;7</a> podemos utilizar a função <code>white()</code> com o argumento <code>interactions = TRUE</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">white</span>(modelo_0, <span class="at">interactions =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  statistic   p.value parameter method       alternative
      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      
1      33.7 0.0000995         9 White's Test greater    </code></pre>
</div>
</div>
<p>Para qualquer uma das variações do teste, a hipótese nula é rejeitada para todos os níveis de significância estatística.</p>
</section>
<section id="teste-de-arch" class="level4">
<h4 class="anchored" data-anchor-id="teste-de-arch">Teste de ARCH</h4>
<p>O teste de ARCH <span class="citation" data-cites="engle_autoregressive_1982">[@engle_autoregressive_1982]</span> pode ser utilizado para detectar a presença de heterocedasticidade condicional, especialmente em séries temporais. A regressão auxiliar do teste de ARCH é dada por:</p>
<p>Para este exemplo vamo utilizar os dados do ficheiro <code>m_reg.xlsx</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>m_reg <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"m_reg.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Estimar o modelo de regressão:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>modelo_0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(gdp <span class="sc">~</span> ind <span class="sc">+</span> ser <span class="sc">+</span> agri <span class="sc">+</span> man, <span class="at">data =</span> m_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para executar o teste de ARCH utilizado a função <code>ArchTest()</code> da biblioteca <code>FinTS</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FinTS)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>teste_arch <span class="ot">&lt;-</span> <span class="fu">ArchTest</span>(<span class="fu">residuals</span>(modelo_0), <span class="at">lags =</span> <span class="dv">1</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>teste_arch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    ARCH LM-test; Null hypothesis: no ARCH effects

data:  residuals(modelo_0)
Chi-squared = 2.6047, df = 1, p-value = 0.1065</code></pre>
</div>
</div>
<p>O argumento <code>lags</code> especifica o número de defasamentos do teste, ou seja, a ordem do modelo ARCH a ser testada. Para a ordem 1, existe heterocedasticidade para qualquer nível de significância estatística (valor P &lt; 0.01). Em que a hipótese nula do teste é: não existem efeitos ARCH para a ordem 1.</p>
</section>
<section id="outros-testes" class="level4">
<h4 class="anchored" data-anchor-id="outros-testes">outros testes</h4>
<p>A biblioteca <code>skedastic</code> oferece uma variedade de outros testes para heterocedasticidade, para mais testes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skedastic)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(<span class="st">"package:skedastic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "alvm.fit"          "anlvm.fit"         "anscombe"         
 [4] "avm.ci"            "avm.fwls"          "avm.vcov"         
 [7] "bamset"            "bickel"            "blus"             
[10] "bootlm"            "breusch_pagan"     "carapeto_holt"    
[13] "cook_weisberg"     "countpeaks"        "dDtrend"          
[16] "diblasi_bowman"    "dpeak"             "dpeakdat"         
[19] "dufour_etal"       "evans_king"        "glejser"          
[22] "godfrey_orme"      "goldfeld_quandt"   "GSS"              
[25] "harrison_mccabe"   "harvey"            "hccme"            
[28] "hetplot"           "honda"             "horn"             
[31] "li_yao"            "pDtrend"           "ppeak"            
[34] "pRQF"              "rackauskas_zuokas" "simonoff_tsai"    
[37] "szroeter"          "T_alpha"           "twosidedpval"     
[40] "verbyla"           "white"             "wilcox_keselman"  
[43] "yuce"              "zhou_etal"        </code></pre>
</div>
</div>
<p>A biblioteca <code>performance</code> oferece funções para avaliar o desempenho de modelos de regressão, incluindo testes de heterocedasticidade, como a <code>check_heteroscedasticity()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">check_heteroscedasticity</span>(modelo_0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OK: Error variance appears to be homoscedastic (p = 0.145).</code></pre>
</div>
</div>
<p>Esta função realiza o teste de Breusch-Pagan LM e fornece até uma resposta visual.</p>
</section>
</section>
</section>
<section id="diagnóstico-da-autocorrelação-dos-erros" class="level2">
<h2 class="anchored" data-anchor-id="diagnóstico-da-autocorrelação-dos-erros">Diagnóstico da Autocorrelação dos erros</h2>
<p>Nesta aplicação vamos utilizar os dados do exemplos anterior (ficheiro <code>m_reg.xlsx</code>) e estimar o modelo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#carregar bibliotecas</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">#carregar dados</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>m_reg <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"m_reg.xlsx"</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co">#estimar modelo</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(gdp <span class="sc">~</span> ind <span class="sc">+</span> ser <span class="sc">+</span> agri <span class="sc">+</span> man, <span class="at">data =</span> m_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="gráfico" class="level3">
<h3 class="anchored" data-anchor-id="gráfico">Gráfico</h3>
<p>A forma informal de detetar a heterocedaticide é através de um gráfico de dispersão dos resíduos e dos resíduos desfasados do modelo. Para isso é necessário o obter os resíduos (<code>u_t</code>) do <code>modelo</code> e os resíduos desfasados (<code>u_t1</code>). No <code>R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>m_reg <span class="ot">&lt;-</span> m_reg <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">u_t =</span> <span class="fu">residuals</span>(modelo), </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">u_t1 =</span> <span class="fu">lag</span>(u_t))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Gráfico de dispersão dos resíduos com <code>ggplot()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico_residuos_autocorr</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(m_reg, <span class="fu">aes</span>(<span class="at">x =</span> u_t1, <span class="at">y =</span> u_t)) <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gráfico de Dispersão dos Resíduos vs Resíduos Desfasados"</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Resíduos Desfasados (u_t-1)"</span>,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Resíduos (u_t)"</span>) <span class="sc">+</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/grafico_residuos-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Através do gráfico podemos que existe autocorrelação nos resíduos.</p>
</section>
<section id="teste-de-durbin-watson" class="level3">
<h3 class="anchored" data-anchor-id="teste-de-durbin-watson">Teste de Durbin-Watson</h3>
<p>O teste de Durbin-Watson (DW) <span class="citation" data-cites="durbin_testing_1950 durbin_testing_1951">[@durbin_testing_1950; @durbin_testing_1951]</span> pode ser utilizado para detectar a presença de autocorrelação nos resíduos de um modelo de regressão. O teste tem os seguintes pressupostos:</p>
<ol type="1">
<li>O modelo tem constante</li>
<li>Autocorrelação de 1ª ordem</li>
<li>Não existe variável dependente desfasada com independente</li>
</ol>
<p>O passo a passo para executar o teste de Durbin-Watson é o seguinte:</p>
<ol type="1">
<li>Estimar o modelo e obter os resíduos.</li>
<li>Calcular a estatística de DW</li>
</ol>
<p><span id="eq-dw"><span class="math display">\[
DW_{stat} = \frac{\sum_{t=2}^{n} (u_t - u_{t-1})^2}{\sum_{t=1}^{n} u_t^2}
\tag{8}\]</span></span></p>
<p>No R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular numerador: soma de (u_t - u_{t-1})^2</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>numerador <span class="ot">&lt;-</span> <span class="fu">sum</span>((m_reg<span class="sc">$</span>u_t[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> m_reg<span class="sc">$</span>u_t[<span class="sc">-</span><span class="fu">nrow</span>(m_reg)])<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular denominador: soma de u_t^2</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>denominador <span class="ot">&lt;-</span> <span class="fu">sum</span>(m_reg<span class="sc">$</span>u_t<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular estatística DW</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>DW_stat <span class="ot">&lt;-</span> numerador <span class="sc">/</span> denominador</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>DW_stat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.262287</code></pre>
</div>
</div>
<p>O valor de <span class="math inline">\(DW_{stat}\)</span> pode também ser obtido através da função <code>dwtest()</code> da biblioteca <code>lmtest</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|label: dw_test</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dwtest</span>(modelo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Durbin-Watson test

data:  modelo
DW = 1.2623, p-value = 0.004077
alternative hypothesis: true autocorrelation is greater than 0</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Construir a tabela com o <span class="math inline">\(DW_{stat}\)</span>:</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/grafico-durbin-watson-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Onde:</p>
<ul>
<li><p><span class="math inline">\(d_I\)</span> é a distância de Durbin-Watson inferior</p></li>
<li><p><span class="math inline">\(d_S\)</span> é a distância de Durbin-Watson superior.</p></li>
</ul>
<p>Os limites para cada nível de significância podem ser obtidas em: <a href="https://www3.nd.edu/%7ewevans1/econ30331/Durbin_Watson_tables.pdf">Durbin-Watson Significance Tables</a></p>
<p>Em alternativa, é possivel calcular o <span class="math inline">\(DW_stat\)</span> e obter diretamente o valor da probabilidade com a função <code>dwtest()</code> da biblioteca <code>lmtest</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|label: dw_test</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dwtest</span>(modelo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Durbin-Watson test

data:  modelo
DW = 1.2623, p-value = 0.004077
alternative hypothesis: true autocorrelation is greater than 0</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>Concluir (a hipótese nula é que não existe autocorrelação)</li>
</ol>
<p>A hipótese nula do teste de DW é que não existe autocorrelação. Considerando o valor da probabilidade, a Hipótese nula é rejeitada para qualquer nível de significância estatística.</p>
<p>A biblioteca <code>performance</code> também tem a função <code>check_autocorrelation()</code> que pode ser utilizada para testar a autocorrelação dos resíduos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|label: performance_check_autocorrelation</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">check_autocorrelation</span>(modelo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: Autocorrelated residuals detected (p = 0.010).</code></pre>
</div>
</div>
<p>O teste DW tem algumas limitações, já mencionadas nos pressupostos. Tem ainda também a limitação de o <span class="math inline">\(DW_stat\)</span> ficar nas zonas de indecisão e com isto não ser conclusivo. Existe também o teste Durbin h-H (DH) que é uma extensão do teste DW e que pode ser utilizado quando a variável dependente é defasada. O teste DH não é tão utilizado como o DW.</p>
</section>
<section id="teste-de-breusch-godfrey" class="level3">
<h3 class="anchored" data-anchor-id="teste-de-breusch-godfrey">Teste de Breusch-Godfrey</h3>
<p>O teste de Breusch-Godfrey <span class="citation" data-cites="breusch_auto_1978 godfrey_testing_1978">[@breusch_auto_1978; @godfrey_testing_1978]</span> tem vantagem de poder ser utilizado para detetar autocorrelação de ordens superiores a 1. O teste tem como base a equação:</p>
<p><span id="eq-breusch_godfrey"><span class="math display">\[
\begin{split}
gdp_t = \beta_0 &amp; + \beta_1 inf_t + \beta_2 ser_t+ \beta_3 agri_t + \beta_4 man_t + \mu_t
\end{split}
\tag{9}\]</span></span></p>
<p>onde:</p>
<p><span id="eq-breusch_godfrey_residuals"><span class="math display">\[
\mu_t = \rho_1 \mu_{t-1} + \rho_2 \mu_{t-2} + ... + \rho_p \mu_{t-p} + \epsilon_t
\tag{10}\]</span></span></p>
<p>onde <span class="math inline">\(p\)</span> é a ordem de autocorrelação a ser testada.</p>
<p>Portanto, a H0: <span class="math inline">\(\rho_1 = rho_2 = ... = rho_p = 0\)</span> (não existe autocorrelação) Enquanto que a H1: pelo menos um <span class="math inline">\(\rho_i \neq 0\)</span> (existe autocorrelação). O teste é feito com o modelo LM (ou seja <a href="#eq-breusch_godfrey" class="quarto-xref">Equation&nbsp;9</a> e a <a href="#eq-breusch_godfrey_residuals" class="quarto-xref">Equation&nbsp;10</a>) em que o <span class="math inline">\(LM_{stat} = (n-\rho)R^2\)</span> e o valor de P é obtido através da distribuição <span class="math inline">\(\chi^2\)</span>. O teste pode ser calculado de forma conveniente com a função <code>bgtest</code>():</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|label: bg_test</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co">#odem 1</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="fu">bgtest</span>(modelo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Breusch-Godfrey test for serial correlation of order up to 1

data:  modelo
LM test = 1.0179, df = 1, p-value = 0.313</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ordem 2</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bgtest</span>(modelo, <span class="at">order =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Breusch-Godfrey test for serial correlation of order up to 2

data:  modelo
LM test = 1.0368, df = 2, p-value = 0.5955</code></pre>
</div>
</div>
<p>O primeiro argumento da função é objeto do modelo. Existem mais alguns argumentos que são necessários <code>order</code> (a ordem da autocorrelação a ser testada) e <code>type</code> (o tipo de teste a ser realizado, como <code>Chisq</code> ou <code>F</code>). Por defeito, o argumento <code>order</code> é 1 e o argumento <code>type</code> é <code>Chisq</code>. A hipótese nula é rejeitada para qualquer nível de significância estatística.</p>
<p>Segundo o resultado do teste, a hipótese nula não foi rejeitada, o que indique que não existe autocorrelação de ordem 1 nem ordem 2.</p>
</section>
</section>
<section id="sec-normalidade" class="level2">
<h2 class="anchored" data-anchor-id="sec-normalidade">Diagnóstico da Normalidade</h2>
<p>Tal como os diagnósticos anteriores, este também pode ser feito através de gráficos e de testes estatísticos. Para esta aplicação vamos utilizar o modelo anterior.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#carregar bibliotecas</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co">#carregar dados</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>m_reg <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"m_reg.xlsx"</span>)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="co">#estimar modelo</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(gdp <span class="sc">~</span> ind <span class="sc">+</span> ser <span class="sc">+</span> agri <span class="sc">+</span> man, <span class="at">data =</span> m_reg)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="co">#obter erro</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>m_reg<span class="sc">$</span>residuos <span class="ot">&lt;-</span> <span class="fu">residuals</span>(modelo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="histograma" class="level3">
<h3 class="anchored" data-anchor-id="histograma">Histograma</h3>
<p>Para o gráfico de histograma dos resíduos e comparar com a linha de normalidade:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(m_reg, <span class="fu">aes</span>(<span class="at">x =</span> residuos)) <span class="sc">+</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density)),</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">mean</span>(m_reg<span class="sc">$</span>residuos), </span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sd =</span> <span class="fu">sd</span>(m_reg<span class="sc">$</span>residuos)), </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histograma dos Resíduos com Curva Normal"</span>, </span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Resíduos"</span>, </span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Densidade"</span>) <span class="sc">+</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/histograma_residuos-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Utilizando exclusivamente a biblioteca o histograma dos resíduos podemos concluir que aparentemente os resíduos seguem uma distribuição normal. É perfeitamente normal em amostras pequenas haver desvios (barras) em relação à distribuição normal (linha vermelha)</p>
</section>
<section id="teste-de-shapiro-wilk" class="level3">
<h3 class="anchored" data-anchor-id="teste-de-shapiro-wilk">Teste de Shapiro-Wilk</h3>
<p>O teste de <span class="citation" data-cites="shapiro_analysis_1965">@shapiro_analysis_1965</span> (SW) é um dos testes mais utilizados para testar a normalidade dos resíduos. A hipótese nula é que os resíduos seguem uma distribuição normal. O teste pode ser realizado com a função <code>shapiro.test()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(m_reg<span class="sc">$</span>residuos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  m_reg$residuos
W = 0.96487, p-value = 0.4735</code></pre>
</div>
</div>
<p>A H0 não é rejeitada para qualquer nível de significância estatística. O <code>W</code> é a estatística do teste. O teste SW tem um grande poder estatístico em detetar desvios em relação à normalidade, pois é muit sensível a desvios tanto no centro como nas caudas da distribuição.</p>
<p>A função <code>check_normality()</code> da biblioteca <code>performance</code> tabém realizado o teste SW:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">check_normality</span>(modelo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OK: residuals appear as normally distributed (p = 0.258).</code></pre>
</div>
</div>
</section>
<section id="teste-de-jarque-bera" class="level3">
<h3 class="anchored" data-anchor-id="teste-de-jarque-bera">Teste de Jarque Bera</h3>
<p>O teste de <span class="citation" data-cites="jarque_test_1987">@jarque_test_1987</span> (JB) é outro teste muito utilizado para verificar a normalidade dos resíduos. A hipótese nula é a mesma do teste SW. O teste pode ser realizado com a função <code>jarque.test()</code> da biblioteca <code>moments</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">#carregar biblioteca</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(moments)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co">#teste de normalidade</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="fu">jarque.test</span>(m_reg<span class="sc">$</span>residuos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Jarque-Bera Normality Test

data:  m_reg$residuos
JB = 3.3251, p-value = 0.1897
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>Como H0 não é rejeitada, os erros seguem uma distribuição normal. Se H0 for rejeitada podemo obter os valores de curtose e assimetria para perceberem a razão dos resíduos não seguirem uma distribuição normal:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Kurtosis (achatamento)</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kurtosis</span>(m_reg<span class="sc">$</span>residuos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.288396</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Skewnedd (assimetria)</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">skewness</span>(m_reg<span class="sc">$</span>residuos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5691352</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-especificacao" class="level2">
<h2 class="anchored" data-anchor-id="sec-especificacao">Testes de Especificação e Estabilidade</h2>
<section id="avaliar-a-especificação" class="level3">
<h3 class="anchored" data-anchor-id="avaliar-a-especificação">Avaliar a Especificação</h3>
<p>A especificação de um modelo de regressão está relacionada com a inclusão de variáveis (Overfitting) que não são relevantes e a exclusão de variáveis relevantes (Underfitting).</p>
<p>A não inclusão de variáveis relevantes pode levar a um modelo mal especificado, em que o valor esperado do resíduos <span class="math inline">\(E[\mu_i|X_i] \neq 0\)</span>, o que faz com que essa variável (omitida) seja confundida com o erro. Já a inclusão de variáveis irrelevantes pode levar a um modelo com excesso de ajustamento, em que o valor esperado do resíduos <span class="math inline">\(E[\mu_i|X_i] = 0\)</span>, mas a inclusão de variáveis desnecessárias (com informação redundante) pode aumentar a variância dos estimadores.</p>
<p>Para este exemplo vamos utilizar os dados <code>wage2</code> da biblioteca <code>wooldridge</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wooldridge)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"wage2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para ver a definição das variáveis executar <code>?wage2</code>.</p>
<p>Vamos estimar o seguinte modelo: <span id="eq-modelo-completo"><span class="math display">\[
wage_i = \beta_0 + \beta_1 educ_i + \beta_2 exper_i + \beta_3 tenure_i + \mu_i
\tag{11}\]</span></span></p>
<p>e o modelo sem a variável <code>tenure</code>:</p>
<p><span id="eq-modelo-restrito"><span class="math display">\[
wage_i = \beta_0 + \beta_1 educ_i + \beta_2 exper_i + \mu_i
\tag{12}\]</span></span></p>
<p>No R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>modelo_completo <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> tenure, <span class="at">data =</span> wage2)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>modelo_restrito <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> exper, <span class="at">data =</span> wage2)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co">#comparar os modelos</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Please cite as: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code> Hlavac, Marek (2022). stargazer: Well-Formatted Regression and Summary Statistics Tables.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code> R package version 5.2.3. https://CRAN.R-project.org/package=stargazer </code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>stargazer<span class="sc">::</span><span class="fu">stargazer</span>(modelo_completo, modelo_restrito, <span class="at">type =</span> <span class="st">"text"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
===================================================================
                                  Dependent variable:              
                    -----------------------------------------------
                                         wage                      
                              (1)                     (2)          
-------------------------------------------------------------------
educ                       74.415***               76.216***       
                            (6.287)                 (6.297)        
                                                                   
exper                      14.892***               17.638***       
                            (3.253)                 (3.162)        
                                                                   
tenure                     8.257***                                
                            (2.498)                                
                                                                   
Constant                  -276.240***             -272.528**       
                           (106.702)               (107.263)       
                                                                   
-------------------------------------------------------------------
Observations                  935                     935          
R2                           0.146                   0.136         
Adjusted R2                  0.143                   0.134         
Residual Std. Error   374.306 (df = 931)      376.295 (df = 932)   
F Statistic         53.003*** (df = 3; 931) 73.260*** (df = 2; 932)
===================================================================
Note:                                   *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
<p>Ao comparar os dois modelos podemos ver que sinais dos coeficinets são consistentes e os valores muito semelhantes. A variável <code>exper</code> representa os anos de experiência profissional e a variável <code>tenure</code> representa os anos na empresa. Será que estas variáveis contém a mesma informação? Pos os anos de <code>exper</code> podem estar contabilizados nos anos de <code>tenure</code>. Para testar vamos utilizar a função <code>waldtest</code> da biblioteca <code>lmtest</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">waldtest</span>(modelo_restrito, modelo_completo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Wald test

Model 1: wage ~ educ + exper
Model 2: wage ~ educ + exper + tenure
  Res.Df Df      F   Pr(&gt;F)    
1    932                       
2    931  1 10.929 0.000983 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Para este caso, estamos a testar se a variável <code>tenure</code> pode ser omitida do modelo. E concluímos que a variável <code>tenure</code> é necessária, ou seja, a informação da variável vai para além da informação do nº de anos de experiência. Está acapturar efeitos como a lealdade do funcionário à empresa, aumento da produtividade ao longo do tempo, entre outros fatores. A variável <code>exper</code> representa apenas a experiência profissional (pode ser numa profissão totalmente diferente). O que nos pode levar a pensar que o modelo está mal especificado se omitirmos a variável <code>tenure</code>. Este resultado també nos pode fazer pensar se a variável <code>exper</code> é mesmo necessário, para despistar vamos fazer um modelo omitindo a variável <code>exper</code> e realziar o teste:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>modelo_completo2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> tenure, <span class="at">data =</span> wage2)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>modelo_restrito2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> tenure, <span class="at">data =</span> wage2)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co">#comparar os modelos</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>stargazer<span class="sc">::</span><span class="fu">stargazer</span>(modelo_completo2, modelo_restrito2, <span class="at">type =</span> <span class="st">"text"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
===================================================================
                                  Dependent variable:              
                    -----------------------------------------------
                                         wage                      
                              (1)                     (2)          
-------------------------------------------------------------------
educ                       74.415***               61.148***       
                            (6.287)                 (5.639)        
                                                                   
exper                      14.892***                               
                            (3.253)                                
                                                                   
tenure                     8.257***                11.177***       
                            (2.498)                 (2.441)        
                                                                   
Constant                  -276.240***               53.519         
                           (106.702)               (79.557)        
                                                                   
-------------------------------------------------------------------
Observations                  935                     935          
R2                           0.146                   0.127         
Adjusted R2                  0.143                   0.125         
Residual Std. Error   374.306 (df = 931)      378.293 (df = 932)   
F Statistic         53.003*** (df = 3; 931) 67.579*** (df = 2; 932)
===================================================================
Note:                                   *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">waldtest</span>(modelo_restrito2, modelo_completo2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Wald test

Model 1: wage ~ educ + tenure
Model 2: wage ~ educ + exper + tenure
  Res.Df Df      F    Pr(&gt;F)    
1    932                        
2    931  1 20.957 5.333e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Concluímos que a variável <code>exper</code> também é necessária no modelo.</p>
<p>E está também relacionada com a forma funcional do modelo. Algumas formas funcionais são:</p>
<ul>
<li><strong>Linear</strong></li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/forma-funcional-linear-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span id="eq-linear"><span class="math display">\[
y_i=\beta_0+\beta_1x_{i}+\mu_i
\tag{13}\]</span></span></p>
<p><span class="math inline">\(\beta_0\)</span>: representa o valor esperado de <span class="math inline">\(y_i\)</span> quando <span class="math inline">\(x_i=0\)</span></p>
<p><span class="math inline">\(\beta_1\)</span>: um aumento de uma unidade em <span class="math inline">\(x_i\)</span> está associado a um aumento de <span class="math inline">\(\beta_1\)</span> unidades em <span class="math inline">\(y_i\)</span>, <em>ceteris paribus</em>.</p>
<ul>
<li><strong>Linear - logarítmica</strong></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/forma-funcional-linear-log-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span id="eq-linear-log"><span class="math display">\[
y_i=\beta_0+\beta_1\ln(x_{i})+\mu_i
\tag{14}\]</span></span></p>
<p><span class="math inline">\(\beta_0\)</span>: representa o valor esperado de <span class="math inline">\(y_i\)</span> quando <span class="math inline">\(ln(x_i)=0\)</span> (ou seja, <span class="math inline">\(x_i=1\)</span>)</p>
<p><span class="math inline">\(\beta_1\)</span>: um aumento de 1% em <span class="math inline">\(x_i\)</span> está associado a um aumento de <span class="math inline">\(\frac{\beta_1}{100}\)</span> unidades em <span class="math inline">\(y_i\)</span>, <em>ceteris paribus</em>.</p>
<ul>
<li><strong>Logarítmica - linear</strong></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/forma-funcional-log-linear-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span id="eq-log-linear"><span class="math display">\[
\ln(y_i)=\beta_0+\beta_1x_{i}+\mu_i
\tag{15}\]</span></span></p>
<p><span class="math inline">\(\beta_0\)</span>: representa o valor esperado de <span class="math inline">\(ln(y_i)\)</span> quando <span class="math inline">\(x_i=0\)</span>, para obter em ralação a <span class="math inline">\(y = e^{\beta_0}\)</span>, no <code>R</code>: <code>exp(coef(modelo))["(Intercept)"]</code>.</p>
<p><span class="math inline">\(\beta_1\)</span>: um aumento de uma unidade em <span class="math inline">\(x_i\)</span> está associado a um aumento de <span class="math inline">\(\beta_1 \cdot 100\)</span> % em <span class="math inline">\(y_i\)</span>, <em>ceteris paribus</em>.</p>
<ul>
<li><strong>Logarítmica - logarítmica</strong></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/forma-funcional-log-log-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span id="eq-log-log"><span class="math display">\[
\ln(y_i)=\beta_0+\beta_1\ln(x_{i})+\mu_i
\tag{16}\]</span></span></p>
<p><span class="math inline">\(\beta_1\)</span>: um aumento de 1% em <span class="math inline">\(x_i\)</span> está associado a um aumento de <span class="math inline">\(\beta_1\)</span> % em <span class="math inline">\(y_i\)</span>, <em>ceteris paribus</em>.</p>
<ul>
<li><strong>Exponencial</strong></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/forma-funcional-exponencial-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span class="math display">\[
y_i=\beta_0\beta_1^{x_i}\mu_i
\]</span></p>
<p>com LN’s podemos linearizar a equação exponencial:</p>
<p><span class="math display">\[
\ln(y_i)=\ln(\beta_0)+\ln(\beta_1).x_i+\ln(\mu_i)
\]</span></p>
<p>e estimar:</p>
<p><span class="math display">\[
\ln(y_i)=\beta'_0+\beta'_1x_i+\mu'_i
\]</span></p>
<ul>
<li><strong>Potência</strong></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/forma-funcional-potencia-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span id="eq-potencia"><span class="math display">\[
y_i=\beta_0X_i^{\beta_1}\mu_i
\tag{17}\]</span></span></p>
<p>Com LN’s:</p>
<p><span id="eq-potencia2"><span class="math display">\[
ln(y_i)=ln(\beta_0)+\beta_1.ln(x_i)+ln(\mu_i)
\tag{18}\]</span></span></p>
<p>para estimar: <span id="eq-potencia3"><span class="math display">\[
ln(y_i)=\beta'_0+\beta_1 ln(x_i)+\mu'_i
\tag{19}\]</span></span></p>
<ul>
<li><strong>Polinomial</strong></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/forma-funcional-polinomio-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span id="eq-polinomial"><span class="math display">\[
y_i=\beta_0+\beta_1x_i+\beta_2x_i^{2}+\mu_i
\tag{20}\]</span></span></p>
<p>para estimar:</p>
<p><span id="eq-polinomial2"><span class="math display">\[
z_i=x'_i=x_i^2
\tag{21}\]</span></span></p>
<ul>
<li><strong>Hiperbólica</strong></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/forma-funcional-hiperbolica-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span id="eq-hiperbolica"><span class="math display">\[
y_i=\beta_0+\beta_1\frac{1}x_i+\mu_i
\tag{22}\]</span></span></p>
<p>para estimar:</p>
<p><span id="eq-hiperbolica2"><span class="math display">\[
w_i=x'_i=\frac{1}x_i
\tag{23}\]</span></span></p>
<p>Depois de linearizar, a interpretação da forma funcional é semelhante às lineares.</p>
</section>
<section id="teste-de-ramsey-reset" class="level3">
<h3 class="anchored" data-anchor-id="teste-de-ramsey-reset">Teste de Ramsey RESET</h3>
<p>O teste de Ramsey RESET <span class="citation" data-cites="ramsey_tests_1969">[@ramsey_tests_1969]</span> é utilizado para testar a especificação do modelo, nomeadamente se a forma funcional está correta. Para evitar que:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/ma-especificação-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>O teste consiste em:</p>
<ol type="1">
<li>Estimar o modelo e obter os valores previstos (<code>wage_hat</code>).</li>
<li>Incluir termos polinomiais das variáveis independentes e reestimar o modelo com os termos (<code>wage_hat^2</code>, <code>wage_hat^3</code>, …).</li>
<li>Realizar o teste F para verificar se os coeficientes dos termos polinomiais são conjuntamente significativos.</li>
</ol>
<p>No R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">#estimar modelo</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> tenure, <span class="at">data =</span> wage2)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="co">#obter valores previstos e y^ e y^3</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a> wage2 <span class="ot">&lt;-</span> wage2 <span class="sc">|&gt;</span> </span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">wage_hat =</span> <span class="fu">predict</span>(modelo),</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">wage_hat2 =</span> wage_hat<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">wage_hat3 =</span> wage_hat<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>modelo_reset <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> tenure <span class="sc">+</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>              wage_hat2 <span class="sc">+</span> wage_hat3, <span class="at">data =</span> wage2)</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="co">#teste</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a><span class="fu">waldtest</span>(modelo, modelo_reset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Wald test

Model 1: wage ~ educ + exper + tenure
Model 2: wage ~ educ + exper + tenure + wage_hat2 + wage_hat3
  Res.Df Df      F Pr(&gt;F)
1    931                 
2    929  2 0.5526 0.5756</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ou diretamente</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">resettest</span>(modelo, <span class="at">power =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    RESET test

data:  modelo
RESET = 0.55259, df1 = 2, df2 = 929, p-value = 0.5756</code></pre>
</div>
</div>
<p>O argumento <code>power</code> do teste de Ramsey RESET especifica os graus de liberdade dos termos polinomiais a serem incluídos no modelo. Neste caso, estamos a incluir os termos quadráticos e cúbicos.</p>
<p>A hipótese nula do teste de Ramsey RESET é que o modelo original está corretamente especificado. Como a H0 não é rejeitada para nenhum nível de significância estatística, não há evidências suficientes para concluir que o modelo esteja mal especificado.</p>
</section>
<section id="teste-de-estabilidade-dos-coeficientes" class="level3">
<h3 class="anchored" data-anchor-id="teste-de-estabilidade-dos-coeficientes">Teste de estabilidade dos coeficientes</h3>
<p>A estabilidade dos coeficientes pode ser realizado com o teste CUSUM <span class="citation" data-cites="ploberger_cusum_1992">[@ploberger_cusum_1992]</span>. Este teste verifica se os coeficientes do modelo permanecem constantes ao longo da amostra.</p>
<p>No <code>R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co">#estimar modelo</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> tenure, <span class="at">data =</span> wage2)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste CUSUM</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(strucchange)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sandwich</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'strucchange'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stringr':

    boundary</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste CUSUMSQ</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sctest</span>(modelo, <span class="at">type =</span> <span class="st">"CUSUM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    M-fluctuation test

data:  modelo
f(efp) = 1.6798, p-value = 0.02803</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">#graficamente</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">efp</span>(modelo, <span class="at">data =</span> wage2, <span class="at">type =</span> <span class="st">"Rec-CUSUM"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/cusum_cusumsq-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A hipótese nula do teste CUSUM é que os coeficientes são estáveis ao longo do tempo. H0 é rejeitada para 5% e 10%. A forma de apresentação mais comum é o gráfico onde é possível visualizar a estabilidade dos coeficientes ao longo da amostra, as linhas vermelhas representam os limites de significância de 5% e a preta representa a estatística do teste. Se a linha preta ultrapassar as linhas vermelhas, rejeitamos a hipótese nula de estabilidade.</p>
</section>
</section>
<section id="testes-gerais" class="level2">
<h2 class="anchored" data-anchor-id="testes-gerais">Testes Gerais</h2>
<p>A biblioteca <code>performance</code> tem a função <code>check_model()</code> que realiza uma série de testes visuais para diagnosticar um modelo de regressão. Vamos utilizar o exemplo anterior, para dados seccionais, e executar a função:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">#carregar bibliotecas</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wooldridge)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="co">#carregar dados</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"wage2"</span>)</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="co">#estimar modelo</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> tenure, <span class="at">data =</span> wage2)</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(modelo, <span class="at">check =</span> <span class="st">"all"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/check_model3-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>O resultado da função são 6 gráficos:</p>
<ol type="1">
<li>“Posterior Predictive Check”: Verifica a distribuição dos valores previstos em relação aos valores observados.</li>
<li>“Linearity”: Verifica a linearidade da relação entre as variáveis independentes e a variável dependente.</li>
<li>“Homogeneity of Variance”: Verifica se a variância dos resíduos é constante (homocedasticidade).</li>
<li>“Influential Observations”: Identifica observações que têm um impacto desproporcional na estimativa dos coeficientes do modelo.</li>
<li>“Colinearity”: Verifica se há colinearidade entre as variáveis independentes.</li>
<li>“Normality of Residuals”: Verifica se os resíduos seguem uma distribuição normal.</li>
</ol>
<p>A descrição completa de cada um deles pode ser verificada com <code>?performance::check_model</code>.</p>
<p>O título de cada gráfico é autoexplicativo. No subtítulo de cada um deles está a informação adicional sobre o que deveríamos verificar para que o modelo seja adequada. Esta é uma ferramenta muito útil para ter uma visão geral do modelo e diagnosticar potenciais problemas.</p>
<p>Para este modelo podemos concluir que:</p>
<ol type="1">
<li>O modelo captura bem a distribuição dos dados</li>
<li>A relação entre as variáveis independentes e a variável dependente aparenta ser linear, mas pode ser melhorada.</li>
<li>Poderá existir heterocedasticidade (é necessário fazer os testes)</li>
<li>Não existem observações influentes (o modelo está dentro das linhas de distância de Cook’s)</li>
<li>Não há indícios de colinearidade entre as variáveis independentes.</li>
<li>Os resíduos não parecem seguir uma distribuição normal ( as observação deveriam estar em cima da linha verde)</li>
</ol>
<p>Agora um exemplo para séries temporais:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">#carregar bibliotecas</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl) </span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="co">#carregar dados</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>m_reg <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"m_reg.xlsx"</span>)</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="co">#estimar modelo</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>modelo_st <span class="ot">&lt;-</span> <span class="fu">lm</span>(gdp <span class="sc">~</span> ind <span class="sc">+</span> agri <span class="sc">+</span> ser <span class="sc">+</span> man, <span class="at">data =</span> m_reg)</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(modelo_st)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/check_model2-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<ol type="1">
<li>O modelo captura bem a distribuição dos dados.</li>
<li>A relação entre as variáveis independentes e a variável dependente não aparenta ser linear, e por isso deve ser melhorada (exemplo: introduzir termos quadráticos ou interações).</li>
<li>Aparentemente existe heterocedasticidade.</li>
<li>Não existem observações influentes (o modelo está dentro das linhas de distância de Cook’s).</li>
<li>Existem indícios de colinearidade entre as variáveis <code>ind</code>, <code>agri</code> e <code>ser</code>.</li>
<li>Os resíduos estão muito próximos de seguir uma distribuição normal.</li>
</ol>
</section>
<section id="sec-selecao-modelos" class="level2">
<h2 class="anchored" data-anchor-id="sec-selecao-modelos">Seleção de Modelos</h2>
<p>Os modelos devem ser escolhidos com base na capacidade de previsão e na parcimónia (simplicidade). O primeiro passo é definir um conjunto de modelos candidatos, quer seja pela número de variáveis independentes, quer seja pela sua estrutura funcional.</p>
<p>Para este exemplo vamos utilizar a base de dados <code>hprice3</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">#carregar bibliotecas</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wooldridge)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co">#carregar dados</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"hprice3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A comparação de modelos é essencial para garantir que escolhemos o modelo mais adequado para os nossos dados. Quando a variável dependente é a mesma, devemos ter em consideração, entre modelos, as trocas de sinais dos coeficientes, a significância estatística e o coeficiente de determinação ajustado.</p>
<p>Vamos começar por estimar alguns modelos para explicar o preço das casas. E vamos compará-los com a função <code>stargazer</code> e com a função <code>tbl_regression</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar modelos</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>modelo1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> area <span class="sc">+</span> rooms <span class="sc">+</span> age, </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> hprice3)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>modelo2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> area <span class="sc">+</span> inst <span class="sc">+</span> rooms <span class="sc">+</span> age, </span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> hprice3)</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>modelo3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> area <span class="sc">+</span> inst <span class="sc">+</span> rooms <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(inst<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> hprice3)</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>modelo4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> area <span class="sc">+</span> inst <span class="sc">+</span> rooms <span class="sc">+</span> age <span class="sc">+</span> </span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">I</span>(rooms<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> hprice3)</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="co">#comparar com stargazer</span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(modelo1, modelo2, modelo3, modelo4, </span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"text"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
====================================================================================================================
                                                          Dependent variable:                                       
                    ------------------------------------------------------------------------------------------------
                                                                 price                                              
                              (1)                      (2)                     (3)                     (4)          
--------------------------------------------------------------------------------------------------------------------
area                       35.091***                35.187***               33.078***               32.757***       
                            (2.865)                  (2.863)                 (2.891)                 (2.895)        
                                                                                                                    
inst                                                 -0.273                 2.545***                -0.586***       
                                                     (0.212)                 (0.882)                 (0.224)        
                                                                                                                    
rooms                     6,062.454***            6,795.345***             5,565.108**              2,246.530       
                          (2,209.610)              (2,279.613)             (2,276.052)            (16,337.200)      
                                                                                                                    
age                       -397.964***              -426.322***             -387.241***            -1,053.441***     
                            (51.747)                (56.195)                (56.606)                (168.996)       
                                                                                                                    
I(inst2)                                                                   -0.0001***                               
                                                                            (0.00002)                               
                                                                                                                    
I(rooms2)                                                                                            114.788        
                                                                                                   (1,204.167)      
                                                                                                                    
I(age2)                                                                                             4.329***        
                                                                                                     (1.106)        
                                                                                                                    
Constant                  -10,585.510              -10,612.260             -16,647.810             29,842.910       
                          (12,623.150)            (12,610.130)            (12,554.040)            (54,548.440)      
                                                                                                                    
--------------------------------------------------------------------------------------------------------------------
Observations                  321                      321                     321                     321          
R2                           0.520                    0.522                   0.538                   0.545         
Adjusted R2                  0.515                    0.516                   0.531                   0.536         
Residual Std. Error  30,098.970 (df = 317)    30,067.870 (df = 316)   29,612.130 (df = 315)   29,448.930 (df = 314) 
F Statistic         114.307*** (df = 3; 317) 86.321*** (df = 4; 316) 73.359*** (df = 5; 315) 62.562*** (df = 6; 314)
====================================================================================================================
Note:                                                                                    *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">#comparar com gtsummary</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>tbl1 <span class="ot">&lt;-</span> <span class="fu">tbl_regression</span>(modelo1) <span class="sc">|&gt;</span> <span class="co">#converter</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_glance_source_note</span>() <span class="co">#adiciona metricas</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>tbl2 <span class="ot">&lt;-</span> <span class="fu">tbl_regression</span>(modelo2) <span class="sc">|&gt;</span> </span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_glance_source_note</span>()</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>tbl3 <span class="ot">&lt;-</span> <span class="fu">tbl_regression</span>(modelo3) <span class="sc">|&gt;</span> </span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_glance_source_note</span>()</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>tbl4 <span class="ot">&lt;-</span> <span class="fu">tbl_regression</span>(modelo4) <span class="sc">|&gt;</span> </span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_glance_source_note</span>()</span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_merge</span>(<span class="at">tbls=</span><span class="fu">list</span>(tbl1, tbl2, tbl3, tbl4),  <span class="co">#mostar modelos</span></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">tab_spanner =</span> <span class="fu">c</span>(<span class="st">"Modelo 1"</span>, <span class="st">"Modelo 2"</span>, </span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"Modelo 3"</span>, <span class="st">"Modelo 4"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="sbrmgoexmg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#sbrmgoexmg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#sbrmgoexmg thead, #sbrmgoexmg tbody, #sbrmgoexmg tfoot, #sbrmgoexmg tr, #sbrmgoexmg td, #sbrmgoexmg th {
  border-style: none;
}

#sbrmgoexmg p {
  margin: 0;
  padding: 0;
}

#sbrmgoexmg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#sbrmgoexmg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#sbrmgoexmg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#sbrmgoexmg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#sbrmgoexmg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sbrmgoexmg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sbrmgoexmg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sbrmgoexmg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#sbrmgoexmg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#sbrmgoexmg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#sbrmgoexmg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#sbrmgoexmg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#sbrmgoexmg .gt_spanner_row {
  border-bottom-style: hidden;
}

#sbrmgoexmg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#sbrmgoexmg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#sbrmgoexmg .gt_from_md > :first-child {
  margin-top: 0;
}

#sbrmgoexmg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#sbrmgoexmg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#sbrmgoexmg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#sbrmgoexmg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#sbrmgoexmg .gt_row_group_first td {
  border-top-width: 2px;
}

#sbrmgoexmg .gt_row_group_first th {
  border-top-width: 2px;
}

#sbrmgoexmg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sbrmgoexmg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#sbrmgoexmg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#sbrmgoexmg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sbrmgoexmg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sbrmgoexmg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#sbrmgoexmg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#sbrmgoexmg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#sbrmgoexmg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sbrmgoexmg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sbrmgoexmg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sbrmgoexmg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sbrmgoexmg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sbrmgoexmg .gt_left {
  text-align: left;
}

#sbrmgoexmg .gt_center {
  text-align: center;
}

#sbrmgoexmg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#sbrmgoexmg .gt_font_normal {
  font-weight: normal;
}

#sbrmgoexmg .gt_font_bold {
  font-weight: bold;
}

#sbrmgoexmg .gt_font_italic {
  font-style: italic;
}

#sbrmgoexmg .gt_super {
  font-size: 65%;
}

#sbrmgoexmg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#sbrmgoexmg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#sbrmgoexmg .gt_indent_1 {
  text-indent: 5px;
}

#sbrmgoexmg .gt_indent_2 {
  text-indent: 10px;
}

#sbrmgoexmg .gt_indent_3 {
  text-indent: 15px;
}

#sbrmgoexmg .gt_indent_4 {
  text-indent: 20px;
}

#sbrmgoexmg .gt_indent_5 {
  text-indent: 25px;
}

#sbrmgoexmg .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#sbrmgoexmg div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="gt_col_headings gt_spanner_row header">
<th rowspan="2" id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th colspan="3" id="level 1; estimate_1" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
Modelo 1
</div></th>
<th colspan="3" id="level 1; estimate_2" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
Modelo 2
</div></th>
<th colspan="3" id="level 1; estimate_3" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
Modelo 3
</div></th>
<th colspan="3" id="level 1; estimate_4" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
Modelo 4
</div></th>
</tr>
<tr class="gt_col_headings even">
<th id="estimate_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Beta</strong></th>
<th id="conf.low_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>95% CI</strong></th>
<th id="p.value_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong></th>
<th id="estimate_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Beta</strong></th>
<th id="conf.low_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>95% CI</strong></th>
<th id="p.value_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong></th>
<th id="estimate_3" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Beta</strong></th>
<th id="conf.low_3" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>95% CI</strong></th>
<th id="p.value_3" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong></th>
<th id="estimate_4" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Beta</strong></th>
<th id="conf.low_4" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>95% CI</strong></th>
<th id="p.value_4" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">area</td>
<td class="gt_row gt_center" headers="estimate_1">35</td>
<td class="gt_row gt_center" headers="conf.low_1">29, 41</td>
<td class="gt_row gt_center" headers="p.value_1">&lt;0.001</td>
<td class="gt_row gt_center" headers="estimate_2">35</td>
<td class="gt_row gt_center" headers="conf.low_2">30, 41</td>
<td class="gt_row gt_center" headers="p.value_2">&lt;0.001</td>
<td class="gt_row gt_center" headers="estimate_3">33</td>
<td class="gt_row gt_center" headers="conf.low_3">27, 39</td>
<td class="gt_row gt_center" headers="p.value_3">&lt;0.001</td>
<td class="gt_row gt_center" headers="estimate_4">33</td>
<td class="gt_row gt_center" headers="conf.low_4">27, 38</td>
<td class="gt_row gt_center" headers="p.value_4">&lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">rooms</td>
<td class="gt_row gt_center" headers="estimate_1">6,062</td>
<td class="gt_row gt_center" headers="conf.low_1">1,715, 10,410</td>
<td class="gt_row gt_center" headers="p.value_1">0.006</td>
<td class="gt_row gt_center" headers="estimate_2">6,795</td>
<td class="gt_row gt_center" headers="conf.low_2">2,310, 11,280</td>
<td class="gt_row gt_center" headers="p.value_2">0.003</td>
<td class="gt_row gt_center" headers="estimate_3">5,565</td>
<td class="gt_row gt_center" headers="conf.low_3">1,087, 10,043</td>
<td class="gt_row gt_center" headers="p.value_3">0.015</td>
<td class="gt_row gt_center" headers="estimate_4">2,247</td>
<td class="gt_row gt_center" headers="conf.low_4">-29,898, 34,391</td>
<td class="gt_row gt_center" headers="p.value_4">0.9</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">age</td>
<td class="gt_row gt_center" headers="estimate_1">-398</td>
<td class="gt_row gt_center" headers="conf.low_1">-500, -296</td>
<td class="gt_row gt_center" headers="p.value_1">&lt;0.001</td>
<td class="gt_row gt_center" headers="estimate_2">-426</td>
<td class="gt_row gt_center" headers="conf.low_2">-537, -316</td>
<td class="gt_row gt_center" headers="p.value_2">&lt;0.001</td>
<td class="gt_row gt_center" headers="estimate_3">-387</td>
<td class="gt_row gt_center" headers="conf.low_3">-499, -276</td>
<td class="gt_row gt_center" headers="p.value_3">&lt;0.001</td>
<td class="gt_row gt_center" headers="estimate_4">-1,053</td>
<td class="gt_row gt_center" headers="conf.low_4">-1,386, -721</td>
<td class="gt_row gt_center" headers="p.value_4">&lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">inst</td>
<td class="gt_row gt_center" headers="estimate_1"><br>
</td>
<td class="gt_row gt_center" headers="conf.low_1"><br>
</td>
<td class="gt_row gt_center" headers="p.value_1"><br>
</td>
<td class="gt_row gt_center" headers="estimate_2">-0.27</td>
<td class="gt_row gt_center" headers="conf.low_2">-0.69, 0.14</td>
<td class="gt_row gt_center" headers="p.value_2">0.2</td>
<td class="gt_row gt_center" headers="estimate_3">2.5</td>
<td class="gt_row gt_center" headers="conf.low_3">0.81, 4.3</td>
<td class="gt_row gt_center" headers="p.value_3">0.004</td>
<td class="gt_row gt_center" headers="estimate_4">-0.59</td>
<td class="gt_row gt_center" headers="conf.low_4">-1.0, -0.14</td>
<td class="gt_row gt_center" headers="p.value_4">0.009</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">I(inst^2)</td>
<td class="gt_row gt_center" headers="estimate_1"><br>
</td>
<td class="gt_row gt_center" headers="conf.low_1"><br>
</td>
<td class="gt_row gt_center" headers="p.value_1"><br>
</td>
<td class="gt_row gt_center" headers="estimate_2"><br>
</td>
<td class="gt_row gt_center" headers="conf.low_2"><br>
</td>
<td class="gt_row gt_center" headers="p.value_2"><br>
</td>
<td class="gt_row gt_center" headers="estimate_3">0.00</td>
<td class="gt_row gt_center" headers="conf.low_3">0.00, 0.00</td>
<td class="gt_row gt_center" headers="p.value_3">0.001</td>
<td class="gt_row gt_center" headers="estimate_4"><br>
</td>
<td class="gt_row gt_center" headers="conf.low_4"><br>
</td>
<td class="gt_row gt_center" headers="p.value_4"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">I(rooms^2)</td>
<td class="gt_row gt_center" headers="estimate_1"><br>
</td>
<td class="gt_row gt_center" headers="conf.low_1"><br>
</td>
<td class="gt_row gt_center" headers="p.value_1"><br>
</td>
<td class="gt_row gt_center" headers="estimate_2"><br>
</td>
<td class="gt_row gt_center" headers="conf.low_2"><br>
</td>
<td class="gt_row gt_center" headers="p.value_2"><br>
</td>
<td class="gt_row gt_center" headers="estimate_3"><br>
</td>
<td class="gt_row gt_center" headers="conf.low_3"><br>
</td>
<td class="gt_row gt_center" headers="p.value_3"><br>
</td>
<td class="gt_row gt_center" headers="estimate_4">115</td>
<td class="gt_row gt_center" headers="conf.low_4">-2,254, 2,484</td>
<td class="gt_row gt_center" headers="p.value_4">&gt;0.9</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">I(age^2)</td>
<td class="gt_row gt_center" headers="estimate_1"><br>
</td>
<td class="gt_row gt_center" headers="conf.low_1"><br>
</td>
<td class="gt_row gt_center" headers="p.value_1"><br>
</td>
<td class="gt_row gt_center" headers="estimate_2"><br>
</td>
<td class="gt_row gt_center" headers="conf.low_2"><br>
</td>
<td class="gt_row gt_center" headers="p.value_2"><br>
</td>
<td class="gt_row gt_center" headers="estimate_3"><br>
</td>
<td class="gt_row gt_center" headers="conf.low_3"><br>
</td>
<td class="gt_row gt_center" headers="p.value_3"><br>
</td>
<td class="gt_row gt_center" headers="estimate_4">4.3</td>
<td class="gt_row gt_center" headers="conf.low_4">2.2, 6.5</td>
<td class="gt_row gt_center" headers="p.value_4">&lt;0.001</td>
</tr>
</tbody><tfoot>
<tr class="gt_sourcenotes odd">
<td colspan="13" class="gt_sourcenote">Abbreviation: CI = Confidence Interval</td>
</tr>
<tr class="gt_sourcenotes even">
<td colspan="13" class="gt_sourcenote">R² = 0.545; Adjusted R² = 0.536; Sigma = 29,449; Statistic = 62.6; p-value = &lt;0.001; df = 6; Log-likelihood = -3,755; AIC = 7,526; BIC = 7,556; Deviance = 272,313,154,349; Residual df = 314; No.&nbsp;Obs. = 321</td>
</tr>
<tr class="gt_sourcenotes odd">
<td colspan="13" class="gt_sourcenote">R² = 0.538; Adjusted R² = 0.531; Sigma = 29,612; Statistic = 73.4; p-value = &lt;0.001; df = 5; Log-likelihood = -3,757; AIC = 7,529; BIC = 7,555; Deviance = 276,216,655,491; Residual df = 315; No.&nbsp;Obs. = 321</td>
</tr>
<tr class="gt_sourcenotes even">
<td colspan="13" class="gt_sourcenote">R² = 0.522; Adjusted R² = 0.516; Sigma = 30,068; Statistic = 86.3; p-value = &lt;0.001; df = 4; Log-likelihood = -3,763; AIC = 7,538; BIC = 7,560; Deviance = 285,688,284,750; Residual df = 316; No.&nbsp;Obs. = 321</td>
</tr>
<tr class="gt_sourcenotes odd">
<td colspan="13" class="gt_sourcenote">R² = 0.520; Adjusted R² = 0.515; Sigma = 30,099; Statistic = 114; p-value = &lt;0.001; df = 3; Log-likelihood = -3,764; AIC = 7,537; BIC = 7,556; Deviance = 287,185,487,877; Residual df = 317; No.&nbsp;Obs. = 321</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<p>Numa primeira análise, podemos observar que que o coeficinete da <code>area</code> é consistente entre os modelos. Os coeficientes das variáveis <code>rooms</code> e <code>age</code> também sao bastante consistentes en termos de sinais. A introdução do termo quadrático de <code>inst</code> no modelo 3 faz com que o coeficiente de <code>inst</code> passe a ser estatisticamento diferente de zero. Este deve ser o primeiro passo para perceber a robustez dos coeficientes. Neste exemplo não houve uma razão específica para a escolha dos modelos, mas em situações reais, a escolha deve ser feita com base em teoria económica e conhecimento do domínio/tópico. Existem alguns critérios que podem ser utilizados para comparar modelos:</p>
<section id="all-in" class="level3">
<h3 class="anchored" data-anchor-id="all-in"><em>All in</em></h3>
<p>Neste método, todas as variáveis independentes disponíveis são incluídas no modelo. Este método é simples, mas pode levar a problemas de multicolinearidade e sobreajuste (<em>overfitting</em>). Este método exige <em>prior knowledge</em>. Um exemplo deste método é prever o risco de incumprimento de um empréstimo, onde todas as variáveis disponíveis sobre o cliente são incluídas no modelo, até para comprar o risco entre os vários clientes.</p>
<p>Para exte exemplo vamos utilizar mais uma vez os dados <code>hprice3</code> e estimar um modelo com todas as variáveis disponíveis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wooldridge)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">library</span>(tidyverse))</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"hprice3"</span>)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="co">#excluir variáveis transformadas</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>hprice3 <span class="ot">&lt;-</span> hprice3 <span class="sc">|&gt;</span> </span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(year,agesq, linst, ldist, </span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>            lprice, larea, lland, linstsq))</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar modelo "all in"</span></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>modelo_all_in <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> ., <span class="at">data =</span> hprice3)</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_all_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ ., data = hprice3)

Residuals:
   Min     1Q Median     3Q    Max 
-94658 -13947  -1089  11687 135173 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -2.339e+04  1.184e+04  -1.976  0.04900 *  
age         -2.308e+02  4.940e+01  -4.672 4.46e-06 ***
nbh         -2.024e+03  6.532e+02  -3.099  0.00212 ** 
cbd         -7.693e-01  1.821e+00  -0.423  0.67290    
inst        -2.684e-02  1.281e+00  -0.021  0.98329    
rooms        4.201e+03  1.942e+03   2.164  0.03127 *  
area         2.174e+01  2.769e+00   7.851 6.80e-14 ***
land         1.224e-01  3.770e-02   3.247  0.00129 ** 
baths        1.297e+04  2.858e+03   4.540 8.07e-06 ***
dist         7.814e-01  7.628e-01   1.024  0.30645    
y81          3.589e+04  2.771e+03  12.953  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 23430 on 310 degrees of freedom
Multiple R-squared:  0.7152,    Adjusted R-squared:  0.7061 
F-statistic: 77.87 on 10 and 310 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>O modelo “all in” pode ser útil como um ponto de partida, mas é importante considerar a parcimónia e a interpretabilidade do modelo. Nem sempre o modelo com mais variáveis será o melhor. Este método é o ponto de partida para o próximo método de seleção.</p>
</section>
<section id="backward-elimination" class="level3">
<h3 class="anchored" data-anchor-id="backward-elimination"><em>Backward Elimination</em></h3>
<p>A eliminação é um método de seleção de modelos que começa com um modelo completo e remove iterativamente as variáveis com menos informação. Para isso vamos recorrer à função <code>step()</code> da biblioteca <code>MASS</code>. Primeiro vamos estimar o modelo completo com todas as variáveis e depois aplicar o método de eliminação <em>backward</em>. Para a função <code>stepAIC()</code> vamos utilizar o argumento <code>object</code> que é o modelo completo, e o argumento <code>direction</code> que indica a direção da seleção, neste caso <em>backward</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar modelo completo</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>modelo_completo <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> ., <span class="at">data =</span> hprice3)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar backward elimination</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:gtsummary':

    select</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:wooldridge':

    cement</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>modelo_backward <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(modelo_completo, </span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">direction =</span> <span class="st">"backward"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=6470.58
price ~ age + nbh + cbd + inst + rooms + area + land + baths + 
    dist + y81

        Df  Sum of Sq        RSS    AIC
- inst   1 2.4123e+05 1.7024e+11 6468.6
- cbd    1 9.8066e+07 1.7034e+11 6468.8
- dist   1 5.7629e+08 1.7082e+11 6469.7
&lt;none&gt;                1.7024e+11 6470.6
- rooms  1 2.5705e+09 1.7281e+11 6473.4
- nbh    1 5.2734e+09 1.7552e+11 6478.4
- land   1 5.7894e+09 1.7603e+11 6479.3
- baths  1 1.1318e+10 1.8156e+11 6489.2
- age    1 1.1985e+10 1.8223e+11 6490.4
- area   1 3.3847e+10 2.0409e+11 6526.8
- y81    1 9.2133e+10 2.6237e+11 6607.4

Step:  AIC=6468.58
price ~ age + nbh + cbd + rooms + area + land + baths + dist + 
    y81

        Df  Sum of Sq        RSS    AIC
- dist   1 1.0629e+09 1.7130e+11 6468.6
&lt;none&gt;                1.7024e+11 6468.6
- cbd    1 1.0684e+09 1.7131e+11 6468.6
- rooms  1 2.5824e+09 1.7282e+11 6471.4
- nbh    1 5.4832e+09 1.7573e+11 6476.8
- land   1 5.8105e+09 1.7605e+11 6477.4
- baths  1 1.1320e+10 1.8156e+11 6487.2
- age    1 1.1989e+10 1.8223e+11 6488.4
- area   1 3.3887e+10 2.0413e+11 6524.9
- y81    1 9.2372e+10 2.6261e+11 6605.7

Step:  AIC=6468.58
price ~ age + nbh + cbd + rooms + area + land + baths + y81

        Df  Sum of Sq        RSS    AIC
- cbd    1 3.2900e+07 1.7134e+11 6466.6
&lt;none&gt;                1.7130e+11 6468.6
- rooms  1 2.4764e+09 1.7378e+11 6471.2
- land   1 5.0440e+09 1.7635e+11 6475.9
- nbh    1 5.8906e+09 1.7720e+11 6477.4
- age    1 1.1211e+10 1.8252e+11 6486.9
- baths  1 1.1829e+10 1.8313e+11 6488.0
- area   1 3.2899e+10 2.0420e+11 6523.0
- y81    1 9.3967e+10 2.6527e+11 6607.0

Step:  AIC=6466.64
price ~ age + nbh + rooms + area + land + baths + y81

        Df  Sum of Sq        RSS    AIC
&lt;none&gt;                1.7134e+11 6466.6
- rooms  1 2.4575e+09 1.7380e+11 6469.2
- land   1 5.4354e+09 1.7677e+11 6474.7
- nbh    1 6.6906e+09 1.7803e+11 6476.9
- baths  1 1.1859e+10 1.8320e+11 6486.1
- age    1 1.2175e+10 1.8351e+11 6486.7
- area   1 3.3214e+10 2.0455e+11 6521.5
- y81    1 9.4601e+10 2.6594e+11 6605.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_backward)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ age + nbh + rooms + area + land + baths + 
    y81, data = hprice3)

Residuals:
   Min     1Q Median     3Q    Max 
-98481 -13086  -1139  11638 139184 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -1.766e+04  1.019e+04  -1.733  0.08405 .  
age         -2.168e+02  4.597e+01  -4.716 3.63e-06 ***
nbh         -2.139e+03  6.120e+02  -3.496  0.00054 ***
rooms        4.025e+03  1.899e+03   2.119  0.03489 *  
area         2.128e+01  2.732e+00   7.789 9.98e-14 ***
land         1.084e-01  3.439e-02   3.151  0.00178 ** 
baths        1.314e+04  2.824e+03   4.654 4.80e-06 ***
y81          3.618e+04  2.752e+03  13.146  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 23400 on 313 degrees of freedom
Multiple R-squared:  0.7134,    Adjusted R-squared:  0.707 
F-statistic: 111.3 on 7 and 313 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>O modelo resultante d é mais simples e contém apenas as variáveis informação necessária. Este método é útil para reduzir a complexidade do modelo. Para este método, o critério de seleção padrão é o AIC (Critério de Informação de Akaike). A cada iteração, a variável que, quando removida, resulta na maior redução do AIC é eliminada do modelo. O processo continua até que a remoção de qualquer variável adicional não melhore o AIC.</p>
</section>
<section id="forward-selection" class="level3">
<h3 class="anchored" data-anchor-id="forward-selection"><em>Forward Selection</em></h3>
<p>A seleção <em>forward</em> é o oposto da eliminação <em>backward</em>. Começa com um modelo só com constante e é adiconada a variável com o valor P mais baixo do <em>all in</em>. É adicioanda uma variável de cada vez, em que variável só permanece no modelo se tiver informação suficiente. As variáveis são adicionadas até que nenhuma variável adicional melhore significativamente o modelo. Para este método vamos utilizar o argumento <code>object</code> que é o modelo nulo, o argumento <code>direction</code> que indica a direção da seleção, neste caso <em>forward</em>, e o argumento <code>scope</code> que é o modelo completo. O <code>scope</code> define o limite superior do modelo que pode ser construído.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar modelo nulo</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>modelo_nulo <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> hprice3)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar forward selection</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>modelo_forward <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(modelo_nulo, </span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">direction =</span> <span class="st">"forward"</span>, </span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">scope =</span> <span class="fu">formula</span>(modelo_completo))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=6853.8
price ~ 1

        Df  Sum of Sq        RSS    AIC
+ area   1 2.4898e+11 3.4887e+11 6682.9
+ baths  1 2.3424e+11 3.6362e+11 6696.2
+ y81    1 1.5343e+11 4.4442e+11 6760.6
+ rooms  1 1.1739e+11 4.8046e+11 6785.6
+ age    1 6.5871e+10 5.3198e+11 6818.3
+ cbd    1 2.9096e+10 5.6876e+11 6839.8
+ inst   1 2.8000e+10 5.6985e+11 6840.4
+ nbh    1 2.7872e+10 5.6998e+11 6840.5
+ land   1 2.5512e+10 5.7234e+11 6841.8
+ dist   1 2.3611e+10 5.7424e+11 6842.9
&lt;none&gt;                5.9785e+11 6853.8

Step:  AIC=6682.89
price ~ area

        Df  Sum of Sq        RSS    AIC
+ y81    1 9.6055e+10 2.5281e+11 6581.5
+ age    1 5.4864e+10 2.9401e+11 6630.0
+ baths  1 4.1886e+10 3.0698e+11 6643.8
+ nbh    1 1.8465e+10 3.3040e+11 6667.4
+ dist   1 8.1622e+09 3.4071e+11 6677.3
+ rooms  1 8.1015e+09 3.4077e+11 6677.4
+ cbd    1 7.2749e+09 3.4159e+11 6678.1
+ land   1 5.8607e+09 3.4301e+11 6679.5
+ inst   1 5.6794e+09 3.4319e+11 6679.6
&lt;none&gt;                3.4887e+11 6682.9

Step:  AIC=6581.52
price ~ area + y81

        Df  Sum of Sq        RSS    AIC
+ baths  1 5.4806e+10 1.9801e+11 6505.1
+ age    1 4.1224e+10 2.1159e+11 6526.4
+ rooms  1 1.5120e+10 2.3769e+11 6563.7
+ cbd    1 1.4338e+10 2.3848e+11 6564.8
+ dist   1 1.3921e+10 2.3889e+11 6565.3
+ land   1 1.3706e+10 2.3911e+11 6565.6
+ inst   1 1.2985e+10 2.3983e+11 6566.6
+ nbh    1 1.1678e+10 2.4114e+11 6568.3
&lt;none&gt;                2.5281e+11 6581.5

Step:  AIC=6505.08
price ~ area + y81 + baths

        Df  Sum of Sq        RSS    AIC
+ age    1 1.1929e+10 1.8608e+11 6487.1
+ nbh    1 6.8226e+09 1.9119e+11 6495.8
+ land   1 6.4476e+09 1.9156e+11 6496.5
+ dist   1 1.5748e+09 1.9643e+11 6504.5
+ cbd    1 1.5257e+09 1.9648e+11 6504.6
+ inst   1 1.2522e+09 1.9676e+11 6505.0
&lt;none&gt;                1.9801e+11 6505.1
+ rooms  1 1.2041e+09 1.9680e+11 6505.1

Step:  AIC=6487.14
price ~ area + y81 + baths + age

        Df  Sum of Sq        RSS    AIC
+ nbh    1 6558044922 1.7952e+11 6477.6
+ land   1 5536264112 1.8054e+11 6479.4
+ rooms  1 2800423408 1.8328e+11 6484.3
&lt;none&gt;                1.8608e+11 6487.1
+ dist   1  180122584 1.8590e+11 6488.8
+ cbd    1   54725421 1.8602e+11 6489.0
+ inst   1    8256988 1.8607e+11 6489.1

Step:  AIC=6477.62
price ~ area + y81 + baths + age + nbh

        Df  Sum of Sq        RSS    AIC
+ land   1 5724921758 1.7380e+11 6469.2
+ rooms  1 2747028352 1.7677e+11 6474.7
+ dist   1 1135961225 1.7838e+11 6477.6
&lt;none&gt;                1.7952e+11 6477.6
+ cbd    1  911989874 1.7861e+11 6478.0
+ inst   1  778563582 1.7874e+11 6478.2

Step:  AIC=6469.21
price ~ area + y81 + baths + age + nbh + land

        Df  Sum of Sq        RSS    AIC
+ rooms  1 2457508573 1.7134e+11 6466.6
&lt;none&gt;                1.7380e+11 6469.2
+ dist   1  182635168 1.7361e+11 6470.9
+ cbd    1   14054756 1.7378e+11 6471.2
+ inst   1     759751 1.7379e+11 6471.2

Step:  AIC=6466.64
price ~ area + y81 + baths + age + nbh + land + rooms

       Df Sum of Sq        RSS    AIC
&lt;none&gt;              1.7134e+11 6466.6
+ inst  1 100552078 1.7124e+11 6468.5
+ cbd   1  32900269 1.7130e+11 6468.6
+ dist  1  27334059 1.7131e+11 6468.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_forward)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ area + y81 + baths + age + nbh + land + 
    rooms, data = hprice3)

Residuals:
   Min     1Q Median     3Q    Max 
-98481 -13086  -1139  11638 139184 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -1.766e+04  1.019e+04  -1.733  0.08405 .  
area         2.128e+01  2.732e+00   7.789 9.98e-14 ***
y81          3.618e+04  2.752e+03  13.146  &lt; 2e-16 ***
baths        1.314e+04  2.824e+03   4.654 4.80e-06 ***
age         -2.168e+02  4.597e+01  -4.716 3.63e-06 ***
nbh         -2.139e+03  6.120e+02  -3.496  0.00054 ***
land         1.084e-01  3.439e-02   3.151  0.00178 ** 
rooms        4.025e+03  1.899e+03   2.119  0.03489 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 23400 on 313 degrees of freedom
Multiple R-squared:  0.7134,    Adjusted R-squared:  0.707 
F-statistic: 111.3 on 7 and 313 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Neste modelo, existem duas variáveis que não são estatisticamente significativas, mas que foram incluídas no modelo porque melhoram o AIC. O facto de uma variável não ser estatisticamente significativa não significa que ela não tenha informação para explicar a dependente. A decisão de incluir ou excluir uma variável deve ser baseada em uma combinação de critérios estatísticos e conhecimento tórico.</p>
</section>
<section id="stepwise-selection" class="level3">
<h3 class="anchored" data-anchor-id="stepwise-selection"><em>Stepwise Selection</em></h3>
<p>A seleção <em>stepwise</em> combina os métodos <em>forward</em> e <em>backward</em>. Começa com um modelo nulo e adiciona variáveis como no método <em>forward</em>, mas também verifica se alguma variável já incluída no modelo pode ser removida, como no método <em>backward</em>. Este processo continua até que nenhuma variável adicional possa ser adicionada ou removida. Or argumento <code>object</code> é o modelo nulo, o argumento <code>direction</code> que indica a direção da seleção, neste caso <em>both</em>, e o argumento <code>scope</code> que é o modelo completo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar modelo nulo</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>modelo_nulo <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> hprice3)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar stepwise selection</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>modelo_stepwise <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(modelo_nulo, <span class="at">direction =</span> <span class="st">"both"</span>, <span class="at">scope =</span> <span class="fu">formula</span>(modelo_completo))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=6853.8
price ~ 1

        Df  Sum of Sq        RSS    AIC
+ area   1 2.4898e+11 3.4887e+11 6682.9
+ baths  1 2.3424e+11 3.6362e+11 6696.2
+ y81    1 1.5343e+11 4.4442e+11 6760.6
+ rooms  1 1.1739e+11 4.8046e+11 6785.6
+ age    1 6.5871e+10 5.3198e+11 6818.3
+ cbd    1 2.9096e+10 5.6876e+11 6839.8
+ inst   1 2.8000e+10 5.6985e+11 6840.4
+ nbh    1 2.7872e+10 5.6998e+11 6840.5
+ land   1 2.5512e+10 5.7234e+11 6841.8
+ dist   1 2.3611e+10 5.7424e+11 6842.9
&lt;none&gt;                5.9785e+11 6853.8

Step:  AIC=6682.89
price ~ area

        Df  Sum of Sq        RSS    AIC
+ y81    1 9.6055e+10 2.5281e+11 6581.5
+ age    1 5.4864e+10 2.9401e+11 6630.0
+ baths  1 4.1886e+10 3.0698e+11 6643.8
+ nbh    1 1.8465e+10 3.3040e+11 6667.4
+ dist   1 8.1622e+09 3.4071e+11 6677.3
+ rooms  1 8.1015e+09 3.4077e+11 6677.4
+ cbd    1 7.2749e+09 3.4159e+11 6678.1
+ land   1 5.8607e+09 3.4301e+11 6679.5
+ inst   1 5.6794e+09 3.4319e+11 6679.6
&lt;none&gt;                3.4887e+11 6682.9
- area   1 2.4898e+11 5.9785e+11 6853.8

Step:  AIC=6581.52
price ~ area + y81

        Df  Sum of Sq        RSS    AIC
+ baths  1 5.4806e+10 1.9801e+11 6505.1
+ age    1 4.1224e+10 2.1159e+11 6526.4
+ rooms  1 1.5120e+10 2.3769e+11 6563.7
+ cbd    1 1.4338e+10 2.3848e+11 6564.8
+ dist   1 1.3921e+10 2.3889e+11 6565.3
+ land   1 1.3706e+10 2.3911e+11 6565.6
+ inst   1 1.2985e+10 2.3983e+11 6566.6
+ nbh    1 1.1678e+10 2.4114e+11 6568.3
&lt;none&gt;                2.5281e+11 6581.5
- y81    1 9.6055e+10 3.4887e+11 6682.9
- area   1 1.9161e+11 4.4442e+11 6760.6

Step:  AIC=6505.08
price ~ area + y81 + baths

        Df  Sum of Sq        RSS    AIC
+ age    1 1.1929e+10 1.8608e+11 6487.1
+ nbh    1 6.8226e+09 1.9119e+11 6495.8
+ land   1 6.4476e+09 1.9156e+11 6496.5
+ dist   1 1.5748e+09 1.9643e+11 6504.5
+ cbd    1 1.5257e+09 1.9648e+11 6504.6
+ inst   1 1.2522e+09 1.9676e+11 6505.0
&lt;none&gt;                1.9801e+11 6505.1
+ rooms  1 1.2041e+09 1.9680e+11 6505.1
- area   1 2.9226e+10 2.2723e+11 6547.3
- baths  1 5.4806e+10 2.5281e+11 6581.5
- y81    1 1.0898e+11 3.0698e+11 6643.8

Step:  AIC=6487.14
price ~ area + y81 + baths + age

        Df  Sum of Sq        RSS    AIC
+ nbh    1 6.5580e+09 1.7952e+11 6477.6
+ land   1 5.5363e+09 1.8054e+11 6479.4
+ rooms  1 2.8004e+09 1.8328e+11 6484.3
&lt;none&gt;                1.8608e+11 6487.1
+ dist   1 1.8012e+08 1.8590e+11 6488.8
+ cbd    1 5.4725e+07 1.8602e+11 6489.0
+ inst   1 8.2570e+06 1.8607e+11 6489.1
- age    1 1.1929e+10 1.9801e+11 6505.1
- baths  1 2.5512e+10 2.1159e+11 6526.4
- area   1 3.8341e+10 2.2442e+11 6545.3
- y81    1 9.4988e+10 2.8107e+11 6617.5

Step:  AIC=6477.62
price ~ area + y81 + baths + age + nbh

        Df  Sum of Sq        RSS    AIC
+ land   1 5.7249e+09 1.7380e+11 6469.2
+ rooms  1 2.7470e+09 1.7677e+11 6474.7
+ dist   1 1.1360e+09 1.7838e+11 6477.6
&lt;none&gt;                1.7952e+11 6477.6
+ cbd    1 9.1199e+08 1.7861e+11 6478.0
+ inst   1 7.7856e+08 1.7874e+11 6478.2
- nbh    1 6.5580e+09 1.8608e+11 6487.1
- age    1 1.1665e+10 1.9119e+11 6495.8
- baths  1 2.2965e+10 2.0249e+11 6514.3
- area   1 3.9358e+10 2.1888e+11 6539.2
- y81    1 8.9281e+10 2.6880e+11 6605.2

Step:  AIC=6469.21
price ~ area + y81 + baths + age + nbh + land

        Df  Sum of Sq        RSS    AIC
+ rooms  1 2.4575e+09 1.7134e+11 6466.6
&lt;none&gt;                1.7380e+11 6469.2
+ dist   1 1.8264e+08 1.7361e+11 6470.9
+ cbd    1 1.4055e+07 1.7378e+11 6471.2
+ inst   1 7.5975e+05 1.7379e+11 6471.2
- land   1 5.7249e+09 1.7952e+11 6477.6
- nbh    1 6.7467e+09 1.8054e+11 6479.4
- age    1 1.0746e+10 1.8454e+11 6486.5
- baths  1 1.9943e+10 1.9374e+11 6502.1
- area   1 3.7746e+10 2.1154e+11 6530.3
- y81    1 9.3450e+10 2.6725e+11 6605.3

Step:  AIC=6466.64
price ~ area + y81 + baths + age + nbh + land + rooms

        Df  Sum of Sq        RSS    AIC
&lt;none&gt;                1.7134e+11 6466.6
+ inst   1 1.0055e+08 1.7124e+11 6468.5
+ cbd    1 3.2900e+07 1.7130e+11 6468.6
+ dist   1 2.7334e+07 1.7131e+11 6468.6
- rooms  1 2.4575e+09 1.7380e+11 6469.2
- land   1 5.4354e+09 1.7677e+11 6474.7
- nbh    1 6.6906e+09 1.7803e+11 6476.9
- baths  1 1.1859e+10 1.8320e+11 6486.1
- age    1 1.2175e+10 1.8351e+11 6486.7
- area   1 3.3214e+10 2.0455e+11 6521.5
- y81    1 9.4601e+10 2.6594e+11 6605.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_stepwise)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ area + y81 + baths + age + nbh + land + 
    rooms, data = hprice3)

Residuals:
   Min     1Q Median     3Q    Max 
-98481 -13086  -1139  11638 139184 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -1.766e+04  1.019e+04  -1.733  0.08405 .  
area         2.128e+01  2.732e+00   7.789 9.98e-14 ***
y81          3.618e+04  2.752e+03  13.146  &lt; 2e-16 ***
baths        1.314e+04  2.824e+03   4.654 4.80e-06 ***
age         -2.168e+02  4.597e+01  -4.716 3.63e-06 ***
nbh         -2.139e+03  6.120e+02  -3.496  0.00054 ***
land         1.084e-01  3.439e-02   3.151  0.00178 ** 
rooms        4.025e+03  1.899e+03   2.119  0.03489 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 23400 on 313 degrees of freedom
Multiple R-squared:  0.7134,    Adjusted R-squared:  0.707 
F-statistic: 111.3 on 7 and 313 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="seleção-por-scores" class="level3">
<h3 class="anchored" data-anchor-id="seleção-por-scores">Seleção por Scores</h3>
<p>Os métodos de seleção de modelos podem ser comparados utilizando critérios de informação, como o AIC (Critério de Informação de Akaike) e o BIC (Critério de Informação Bayesiano). Estes critérios penalizam a complexidade do modelo, são muito úteis quando existem muitas variáveis disponíveis.</p>
<p>O AIC é mais flexível e tende a selecionar modelos mais complexos, enquanto o BIC é mais conservador e favorece modelos mais simples. O AIC é calculado:</p>
<p><span id="eq-aic"><span class="math display">\[
AIC = \ln\left(\frac{SSR}{n}\right) + \frac{2k}{n}
\tag{24}\]</span></span></p>
<p>onde: - <span class="math inline">\(SSR\)</span> é a soma dos quadrados dos resíduos do modelo, - <span class="math inline">\(n\)</span> é o número de observações, - <span class="math inline">\(k\)</span> é o número de parâmetros do modelo.</p>
<p>Ou seja, o AIC penaliza o número de parâmetros no modelo (quanto maior o número de parâmetros, maior a penalização). O objetivo é minimizar o AIC, ou seja, escolher o modelo com o menor AIC.</p>
<p>O BIC, também conhecido como Critério de Informação de Schwarz (SIC), é calculado como:</p>
<p><span id="eq-bic"><span class="math display">\[
BIC = \ln\left(\frac{SSR}{n}\right) + \frac{k \ln(n)}{n}
\tag{25}\]</span></span></p>
<p>em que: - <span class="math inline">\(SSR\)</span> é a soma dos quadrados dos resíduos do modelo, - <span class="math inline">\(n\)</span> é o número de observações, - <span class="math inline">\(k\)</span> é o número de parâmetros do modelo.</p>
<p>Ou seja, o BIC penaliza o número de parâmetros no modelo, mas a penalização é mais acentuada do que no AIC, sobretudo em grandes amostras. O objetivo é minimizar o BIC, ou seja, escolher o modelo com o menor BIC.</p>
<p>Para obter o AIC e o BIC de um modelo no <code>R</code> vamos utilizar a função <code>compare_performance()</code> da biblioteca <code>performance</code>. Para um modelo utilizamos a função <code>model_performance()</code>. Vamos estimar 2 modelos para efeitos de comparação:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>modelo1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> area <span class="sc">+</span> rooms <span class="sc">+</span> age, </span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> hprice3)</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>modelo2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> area <span class="sc">+</span> inst <span class="sc">+</span> rooms <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(inst<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> hprice3)</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_performance</span>(modelo1, modelo2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Comparison of Model Performance Indices

Name    | Model |  AIC (weights) | AICc (weights) |  BIC (weights) |    R2
--------------------------------------------------------------------------
modelo1 |    lm | 7537.4 (0.014) | 7537.6 (0.015) | 7556.3 (0.383) | 0.520
modelo2 |    lm | 7528.9 (0.986) | 7529.3 (0.985) | 7555.3 (0.617) | 0.538

Name    | R2 (adj.) |      RMSE |     Sigma
-------------------------------------------
modelo1 |     0.515 | 29910.848 | 30098.969
modelo2 |     0.531 | 29334.076 | 29612.130</code></pre>
</div>
</div>
<p>Obtemos bárias métricas:</p>
<ul>
<li>AIC: Critério de Informação de Akaike</li>
<li>AICc: AIC corrigido para amostras pequenas</li>
<li>BIC: Critério de Informação Bayesiano</li>
<li>R2: Coeficiente de Determinação - mede a proporção da variabilidade na variável dependente que é explicada pelo modelo.</li>
<li>R2 adj: Coeficiente de Determinação Ajustado - ajusta o R² para o número de variáveis independentes no modelo.</li>
<li>RMSE: Raiz do Erro Quadrático Médio (<span class="math inline">\(RMSE = \sqrt{\frac{1}{n}\sum_{i=1}^{n}(y_i - \hat{y}_i)^2}\)</span>) - mede a média dos erros de previsão do modelo.</li>
<li>Sigma: Estimativa do desvio padrão dos resíduos - mede a variabilidade dos resíduos do modelo.</li>
</ul>
<p>O objetivo é minimizar o AIC, BIC, RMSE e o Sigma. Enquanto que o R² e o R² ajustado devem ser maximizados. Neste exemplo, o modelo 2 é melhor em todas as métricas. A escolha entre os modelos deve considerar o trade-off entre a complexidade do modelo e a sua capacidade de prever a variável dependente.</p>
</section>
<section id="validação-cruzada" class="level3">
<h3 class="anchored" data-anchor-id="validação-cruzada">Validação Cruzada</h3>
<p>A validação cruzada é uma técnica utilizada para avaliar a capacidade de previsão de um modelo. O objetivo é dividir os dados em subamostras de treino e de teste, onde o modelo é “treinado” no conjunto de treino e avaliado no conjunto de teste. Existem várias formas de realizar a validação cruzada, mas as mais comuns são a validação cruzada simples (hold-out) e a validação cruzada k-fold.</p>
<p>A Validação Cruzada Simples (Hold-out) consiste em dividir os dados em duas partes: uma para treino e outra para teste. O modelo é “treinado”/estimado com a parte de treino e avaliado com a parte de teste. Esta abordagem é simples, mas muito sensível à forma de como os dados são divididos. Para dividir os dados recorresmos à biblioteca <code>caTools</code> com as funções <code>sample.split()</code> para definir a proporção, e <code>subset()</code> para criar os conjuntos de treino e teste. Para os dados <code>wage3</code> vamos utilizar 70% dos dados para treino e 30% para teste.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dados</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wooldridge)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"wage2"</span>)</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="co">#separar dados treino e teste</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caTools)</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">sample.split</span>(wage2<span class="sc">$</span>wage, <span class="at">SplitRatio =</span> <span class="fl">0.7</span>)</span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>dados_treino <span class="ot">&lt;-</span> <span class="fu">subset</span>(wage2, split <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>dados_teste <span class="ot">&lt;-</span> <span class="fu">subset</span>(wage2, split <span class="sc">==</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Estimar um modelo para com dados de treino e fazemos uma previão com os dados de teste, mas recorremos ao modelo de treino. A métrica mais comum para avaliar a capacidade de previsão é o RMSE (Root Mean Squared Error).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar modelo nos dados de treino</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>modelo_treino <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> tenure, <span class="at">data =</span> dados_treino)</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Prever valores nos dados de teste com o modelo de treino</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>previsoes <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_treino, <span class="at">newdata =</span> dados_teste)</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular RMSE</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((dados_teste<span class="sc">$</span>wage <span class="sc">-</span> previsoes)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>rmse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 365.1301</code></pre>
</div>
</div>
<p>Obtivemos um RMSE de 384.199, o que significa que, em média, as previsões do modelo estão a 384.199 unidades do valor real da variável dependente <code>wage</code>. Este valor pode ser comparado com a média da variável dependente para ter uma ideia da precisão do modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>mean_wage<span class="ot">&lt;-</span><span class="fu">mean</span>(wage2<span class="sc">$</span>wage)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>rmse <span class="sc">/</span> mean_wage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3811596</code></pre>
</div>
</div>
<p>Como a média de <code>wage</code> é 957.9455, o RMSE representa aproximadamente 39% da média, o que indica que o modelo tem uma capacidade de previsão moderada.</p>
<p>Também podemos comparar graficamente o modelo nas duas subamostras:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar data frame combinando dados de treino e teste</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>dados_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valores_Reais =</span> <span class="fu">c</span>(dados_treino<span class="sc">$</span>wage, dados_teste<span class="sc">$</span>wage),</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>  Previsão <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">predict</span>(modelo_treino, <span class="at">newdata =</span> dados_treino), previsoes),</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amostras =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Treino"</span>, <span class="fu">nrow</span>(dados_treino)), <span class="fu">rep</span>(<span class="st">"Teste"</span>, <span class="fu">nrow</span>(dados_teste)))</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados_plot, <span class="fu">aes</span>(<span class="at">x =</span> Valores_Reais, <span class="at">y =</span> Previsão, <span class="at">color =</span> Amostras)) <span class="sc">+</span></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">5.5</span>) <span class="sc">+</span></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Treino"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>, <span class="st">"Teste"</span> <span class="ot">=</span> <span class="st">"coral"</span>)) <span class="sc">+</span></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparação da Previsão: Treino vs Teste"</span>,</span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valores Reais (wage)"</span>,</span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Previsões do Modelo"</span>,</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Amostras"</span>) <span class="sc">+</span></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="capitulo-05-avaliacao-modelos_files/figure-html/holdout_cv3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="validação-cruzada-k-fold" class="level3">
<h3 class="anchored" data-anchor-id="validação-cruzada-k-fold">Validação Cruzada k-Fold</h3>
<p>A validação cruzada k-fold é uma técnica mais robusta do que a validação cruzada simples. Consiste em dividir os dados em k subamostras (folds). O modelo é “treinado” em k-1 <em>folds</em> e testado no <em>fold</em> restante. Este processo é repetido k vezes, cada vez com um fold diferente como conjunto de teste. A métrica de avaliação (por exemplo, RMSE) é então calculada como a média das métricas obtidas em cada iteração.</p>
<p>Para este exemplo vamos utilizar a biblioteca <code>caret</code> que tem uma função específica para realizar a validação cruzada k-fold. Vamos definir o número de folds (k) e utilizar a função <code>trainControl()</code> para configurar a validação cruzada. Depois, utilizamos a função <code>train()</code> para estimar o modelo com validação cruzada.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co">#carregar bibliotecas</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'caret'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    lift</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir controle de treino com validação cruzada k-fold</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>controle_treino <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>) <span class="co"># 10-fold CV</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar modelo com validação cruzada k-fold</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>modelo_kfold <span class="ot">&lt;-</span> <span class="fu">train</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> tenure, </span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> wage2, </span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">"lm"</span>, </span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">trControl =</span> controle_treino)</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Resultados do modelo</span></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(modelo_kfold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

935 samples
  3 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 842, 842, 841, 843, 843, 840, ... 
Resampling results:

  RMSE      Rsquared   MAE     
  373.7798  0.1549275  281.1262

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE médio</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>modelo_kfold<span class="sc">$</span>results<span class="sc">$</span>RMSE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 373.7798</code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R² médio</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>modelo_kfold<span class="sc">$</span>results<span class="sc">$</span>Rsquared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1549275</code></pre>
</div>
</div>
<p>Os valores de RMSE e R² apresentados são a média dos valores obtidos em cada uma das 10 iterações da validação cruzada. O RMSE médio é 372.959, o que indica que, em média, as previsões do modelo estão a 372.959 unidades do valor real da variável dependente <code>wage</code>. O R² médio é 0.1487, o que significa que, em média, o modelo explica aproximadamente 14.87% da variabilidade na variável dependente <code>wage</code>. Provavelmente o modelo pode ser melhorado, seja com a introdução de novas variáveis, seja com a alteração da forma funcional. No próximo capítulo vamos abordar algumas extensões do modeli de regressão linear que podem ajudar a melhorar a capacidade de previsão dos modelos.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>